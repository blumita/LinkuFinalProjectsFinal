import{j as $,a as p,k as T,r as w,c as M,o as j,b as u,f as s,e as i,h as B,P as f,Q as b,d as D,i as c,n as k,g as F,O as y,t as m}from"#entry";import{u as N}from"./DVjSPpAI.js";import{_ as L}from"./DlAUqK2U.js";const V=$("financial",{state:()=>({invoices:[],payments:[],stats:null,loading:!1,error:null}),getters:{getInvoicesByStatus:n=>a=>a==="all"?n.invoices:n.invoices.filter(e=>e.status===a),getPaymentsByStatus:n=>a=>a==="all"?n.payments:n.payments.filter(e=>e.status===a),getTotalPaymentsAmount:n=>n.payments.filter(a=>a.status==="موفق").reduce((a,e)=>a+e.amount,0),getThisMonthPayments:n=>{const a=new Date,e=a.getMonth(),l=a.getFullYear();return n.payments.filter(d=>{const v=d.date.split("/");if(v.length!==3)return!1;const x=parseInt(v[0]),g=parseInt(v[1]);return x===l&&g===e})}},actions:{async fetchInvoices(){this.loading=!0,this.error=null;try{const{$axios:n}=p(),a=await n.get("invoices/list");a.data&&a.data.data&&(this.invoices=a.data.data)}catch(n){this.error=n.message||"خطا در دریافت فاکتورها",this.invoices=[]}finally{this.loading=!1}},async fetchPaymentHistory(){this.loading=!0,this.error=null;try{const{$axios:n}=p(),a=await n.get("transactions/list");a.data&&a.data.data&&(this.payments=a.data.data.map(e=>({id:e.id,title:e.plan||e.description||"پرداخت",amount:typeof e.amount=="string"?parseInt(e.amount.replace(/,/g,"")):e.amount,date:e.date,time:e.time,status:e.status==="success"?"موفق":e.status==="failed"?"ناموفق":"در انتظار",method:e.method||"درگاه بانکی",transactionId:e.ref||e.transactionId||"",description:e.description,icon:this.getPaymentIcon(e.method)})),this.calculateStats())}catch(n){this.error=n.message||"خطا در دریافت تاریخچه پرداخت",this.payments=[]}finally{this.loading=!1}},calculateStats(){const n=this.payments.filter(e=>e.status==="موفق"),a=this.payments.filter(e=>e.status==="ناموفق");this.stats={totalPayments:n.reduce((e,l)=>e+l.amount,0),thisMonthPayments:this.getThisMonthPayments.reduce((e,l)=>l.status==="موفق"?e+l.amount:e,0),successfulCount:n.length,failedCount:a.length}},async downloadInvoice(n){try{const{$axios:a}=p(),e=await a.get(`invoices/${n}/download`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([e.data])),d=document.createElement("a");d.href=l,d.setAttribute("download",`invoice_${n}.pdf`),document.body.appendChild(d),d.click(),d.remove()}catch{throw new Error("خطا در دانلود فاکتور")}},async getInvoiceDetails(n){try{const{$axios:a}=p(),e=await a.get(`invoices/${n}`);return e.data&&e.data.data?e.data.data:null}catch{return null}},getPaymentIcon(n){return{"درگاه بانکی":"ti ti-building-bank","کارت به کارت":"ti ti-credit-card","کیف پول":"ti ti-wallet"}[n]||"ti ti-credit-card"}}}),A={class:"min-h-screen bg-background"},E={class:"fixed top-0 left-0 right-0 z-50 bg-card border-b divide-border"},R={class:"flex items-center justify-between px-4 h-16"},z={class:"pt-20 pb-24 px-6"},O={key:0,class:"space-y-6 animate-pulse"},U={class:"flex items-center gap-3 overflow-x-auto pb-2"},Y={class:"space-y-4"},H={class:"mb-6"},Q={class:"flex items-center gap-3 overflow-x-auto pb-2"},q=["onClick"],G={class:"space-y-4"},J={class:"flex items-start justify-between mb-3"},K={class:"flex-1"},W={class:"flex items-center gap-2 mb-1"},X={class:"font-medium text-foreground"},Z={class:"text-sm text-muted-foreground mb-2"},tt={class:"flex items-center gap-4 text-xs text-muted-foreground"},et={class:"text-left"},st={class:"text-lg font-bold text-foreground"},at={class:"flex items-center justify-between pt-3 border-t border-border/20"},nt={class:"flex items-center gap-3"},ot=["onClick"],it=["onClick"],rt={class:"flex items-center gap-2"},dt={class:"text-xs text-muted-foreground"},lt={key:0,class:"text-center py-12"},ut=T({__name:"invoices",setup(n){const a=V(),e=N(),l=r=>new Intl.NumberFormat("fa-IR").format(r)+" ریال",d=w(!1),v=w("all"),x=[{label:"همه",value:"all"},{label:"پرداخت شده",value:"paid"},{label:"در انتظار",value:"pending"},{label:"منقضی",value:"overdue"}],g=M(()=>a.getInvoicesByStatus(v.value)),I=async r=>{try{await a.downloadInvoice(r),e.success("فاکتور با موفقیت دانلود شد")}catch{e.error("خطا در دانلود فاکتور")}},_=r=>({paid:"bg-green-500/10 text-green-600",pending:"bg-yellow-500/10 text-yellow-600",overdue:"bg-red-500/10 text-red-600",cancelled:"bg-gray-500/10 text-gray-600"})[r]||"bg-muted text-muted-foreground",C=r=>({paid:"پرداخت شده",pending:"در انتظار",overdue:"منقضی",cancelled:"لغو شده"})[r]||"نامشخص",P=r=>({"کارت بانکی":"ti ti-credit-card","کیف پول":"ti ti-wallet","انتقال بانکی":"ti ti-building-bank"})[r]||"ti ti-payment",S=r=>{k(`/financial/invoice/${r}`)};return j(async()=>{d.value=!1,await a.fetchInvoices(),d.value=!0}),(r,t)=>(c(),u("div",A,[s("div",E,[s("div",R,[s("button",{onClick:t[0]||(t[0]=o=>("navigateTo"in r?r.navigateTo:B(k))("/financial")),class:"p-2 hover:bg-secondary rounded-lg transition-colors"},[...t[1]||(t[1]=[s("i",{class:"ti ti-arrow-right text-primary text-xl"},null,-1)])]),t[2]||(t[2]=i()),t[3]||(t[3]=s("h1",{class:"text-lg font-bold text-primary"},"فاکتورها و صورتحساب",-1)),t[4]||(t[4]=i()),t[5]||(t[5]=s("div",{class:"w-10"},null,-1))])]),t[22]||(t[22]=i()),s("div",z,[d.value?(c(),u(f,{key:1},[s("div",H,[s("div",Q,[(c(),u(f,null,b(x,o=>s("button",{key:o.value,onClick:h=>v.value=o.value,class:y(["flex-shrink-0 px-4 py-2 rounded-xl text-sm font-medium transition-all",v.value===o.value?"bg-primary text-white":"bg-muted text-muted-foreground hover:bg-muted/80"])},m(o.label),11,q)),64))])]),t[21]||(t[21]=i()),s("div",G,[(c(!0),u(f,null,b(g.value,o=>(c(),u("div",{key:o.id,class:"bg-card border border-border/20 p-4 rounded-xl hover:bg-card/80 transition-colors"},[s("div",J,[s("div",K,[s("div",W,[s("h5",X,"فاکتور #"+m(o.invoiceNumber),1),t[8]||(t[8]=i()),s("span",{class:y(["text-xs px-2 py-1 rounded-full",_(o.status)])},m(C(o.status)),3)]),t[10]||(t[10]=i()),s("p",Z,m(o.description),1),t[11]||(t[11]=i()),s("div",tt,[s("span",null,"تاریخ صدور: "+m(o.issueDate),1),t[9]||(t[9]=i()),s("span",null,"سررسید: "+m(o.dueDate),1)])]),t[12]||(t[12]=i()),s("div",et,[s("p",st,m(l(o.amount)),1)])]),t[18]||(t[18]=i()),s("div",at,[s("div",nt,[s("button",{onClick:h=>I(o.id),class:"flex items-center gap-1 text-muted-foreground text-sm font-medium hover:text-foreground transition-colors",title:"دانلود PDF"},[...t[13]||(t[13]=[s("i",{class:"ti ti-download text-base"},null,-1),i(),s("span",{class:"hidden sm:inline"},"دانلود",-1)])],8,ot),t[15]||(t[15]=i()),s("button",{onClick:h=>S(o.id),class:"flex items-center gap-1 text-muted-foreground text-sm font-medium hover:text-foreground transition-colors",title:"مشاهده جزئیات"},[...t[14]||(t[14]=[s("i",{class:"ti ti-eye text-base"},null,-1),i(),s("span",{class:"hidden sm:inline"},"جزئیات",-1)])],8,it)]),t[17]||(t[17]=i()),s("div",rt,[s("i",{class:y(P(o.paymentMethod)+" text-muted-foreground text-sm")},null,2),t[16]||(t[16]=i()),s("span",dt,m(o.paymentMethod),1)])])]))),128)),t[20]||(t[20]=i()),g.value.length===0?(c(),u("div",lt,[...t[19]||(t[19]=[s("div",{class:"w-20 h-20 bg-muted/50 rounded-full flex items-center justify-center mx-auto mb-4"},[s("i",{class:"ti ti-file-invoice text-3xl text-muted-foreground"})],-1),i(),s("h3",{class:"text-lg font-medium text-foreground mb-2"},"فاکتوری یافت نشد",-1),i(),s("p",{class:"text-sm text-muted-foreground"},"در این بازه زمانی فاکتوری صادر نشده است",-1)])])):D("",!0)])],64)):(c(),u("div",O,[s("div",U,[(c(),u(f,null,b(4,o=>s("div",{key:o,class:"flex-shrink-0 w-20 h-8 bg-muted rounded-xl"})),64))]),t[7]||(t[7]=i()),s("div",Y,[(c(),u(f,null,b(6,o=>s("div",{key:o,class:"bg-card border border-border p-4 rounded-xl"},[...t[6]||(t[6]=[F('<div class="flex items-start justify-between mb-3" data-v-306abe0a><div class="flex-1 space-y-2" data-v-306abe0a><div class="flex items-center gap-2" data-v-306abe0a><div class="h-4 w-24 bg-muted rounded" data-v-306abe0a></div> <div class="w-16 h-5 bg-muted rounded-full" data-v-306abe0a></div></div> <div class="h-3 w-20 bg-muted-foreground/20 rounded" data-v-306abe0a></div> <div class="h-3 w-16 bg-muted-foreground/20 rounded" data-v-306abe0a></div></div> <div class="text-right space-y-1" data-v-306abe0a><div class="h-5 w-20 bg-muted rounded" data-v-306abe0a></div> <div class="h-3 w-12 bg-muted-foreground/20 rounded" data-v-306abe0a></div></div></div> <div class="flex items-center justify-between" data-v-306abe0a><div class="flex items-center gap-3" data-v-306abe0a><div class="w-8 h-8 bg-muted rounded" data-v-306abe0a></div> <div class="w-8 h-8 bg-muted rounded" data-v-306abe0a></div></div> <div class="h-8 w-20 bg-muted rounded" data-v-306abe0a></div></div>',3)])])),64))])]))])]))}}),ft=L(ut,[["__scopeId","data-v-306abe0a"]]);export{ft as default};
