import{y as V,r as g,d as P,j as $,k as i,q as e,p as o,l as f,v as j,Q as q,R as B,u as r,L as p,E as C,x as a}from"./Ct89Yiyn.js";import{u as L}from"./lVmvsOkf.js";import{a as O}from"#entry";import"./CU4qPF7-.js";import"./ngrFHoWO.js";const R={class:"min-h-screen bg-background"},F={class:"fixed top-0 left-0 right-0 z-40 bg-card border-b border-border"},M={class:"flex items-center h-14 lg:h-16 px-4 lg:px-6"},D={class:"pt-20 lg:pt-24 pb-24 px-4 lg:px-6"},E={class:"max-w-4xl mx-auto"},N={key:0,class:"space-y-6"},S={class:"bg-card rounded-xl border border-border p-6 animate-pulse"},U={key:1},z={class:"bg-card rounded-xl border border-border p-6 mb-6"},A={class:"text-lg font-semibold text-foreground mb-6"},I={class:"space-y-4"},Q={class:"space-y-2"},T={class:"flex items-center justify-between"},G={class:"font-medium text-foreground"},H={class:"text-sm text-muted-foreground"},J={class:"w-full bg-muted/30 rounded-full h-3 overflow-hidden"},K={class:"space-y-2"},W={class:"flex items-center justify-between"},X={class:"font-medium text-foreground"},Y={class:"text-sm text-muted-foreground"},Z={class:"w-full bg-muted/30 rounded-full h-3 overflow-hidden"},tt={class:"grid grid-cols-2 gap-4 mb-6"},et={class:"bg-card rounded-xl border border-border p-4"},st={class:"text-2xl font-bold text-foreground"},ot={class:"bg-card rounded-xl border border-border p-4"},nt={class:"text-2xl font-bold text-primary"},lt={key:2,class:"text-center py-12"},ct=V({__name:"PollPage",setup(rt){const b=C(),y=L(),{$axios:w}=O(),u=g(!0),s=g(null),_=async()=>{const v=y.defaultCard?.id;if(v){u.value=!0;try{const l=await w.get(`v1/cards/${v}/votes`),d=l.data?.polls||[],n=l.data?.total_votes||0;if(d.length>0&&d[0].options){const c=d[0],m=c.options[0]||{votes_count:0},x=c.options[1]||{votes_count:0};s.value={question:c.question,yesVotes:m.votes_count,noVotes:x.votes_count,totalVotes:n,yesPercentage:n>0?Math.round(m.votes_count/n*100):0,noPercentage:n>0?Math.round(x.votes_count/n*100):0}}}catch{}finally{u.value=!1}}},h=()=>{if(!s.value)return;const t="\uFEFF"+["سوال,گزینه,تعداد رای,درصد",`"${s.value.question}","بله",${s.value.yesVotes},${s.value.yesPercentage}%`,`"${s.value.question}","خیر",${s.value.noVotes},${s.value.noPercentage}%`].join(`
`),l=new Blob([t],{type:"text/csv;charset=utf-8"}),d=window.URL.createObjectURL(l),n=document.createElement("a");n.href=d,n.download="نظرسنجی.csv",n.click(),window.URL.revokeObjectURL(d)},k=P(()=>s.value?.totalVotes||0);return $(()=>{_()}),(v,t)=>(a(),i("div",R,[e("div",F,[e("div",M,[e("button",{onClick:t[0]||(t[0]=l=>j(b).back()),class:"flex items-center justify-center w-10 h-10 rounded-lg text-foreground hover:bg-muted transition-colors"},[...t[1]||(t[1]=[e("i",{class:"ti ti-arrow-right text-xl"},null,-1)])]),t[3]||(t[3]=o()),t[4]||(t[4]=e("div",{class:"flex-1 text-center lg:text-right lg:mr-4"},[e("h1",{class:"text-lg lg:text-xl font-bold text-foreground"},"نظرسنجی")],-1)),t[5]||(t[5]=o()),!u.value&&k.value>0?(a(),i("button",{key:0,onClick:h,class:"px-4 py-2 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center gap-2"},[...t[2]||(t[2]=[e("i",{class:"ti ti-download text-lg"},null,-1),o(),e("span",{class:"hidden lg:inline"},"خروجی",-1)])])):f("",!0)])]),t[22]||(t[22]=o()),e("div",D,[e("div",E,[u.value?(a(),i("div",N,[e("div",S,[t[7]||(t[7]=e("div",{class:"h-6 bg-muted rounded w-3/4 mb-6"},null,-1)),t[8]||(t[8]=o()),(a(),i(q,null,B(2,l=>e("div",{key:l,class:"mb-4"},[...t[6]||(t[6]=[e("div",{class:"flex justify-between mb-2"},[e("div",{class:"h-8 bg-muted rounded w-32"}),o(),e("div",{class:"h-6 bg-muted rounded w-12"})],-1),o(),e("div",{class:"h-3 bg-muted rounded w-full"},null,-1)])])),64))])])):s.value?(a(),i("div",U,[e("div",z,[e("h2",A,r(s.value.question),1),t[14]||(t[14]=o()),e("div",I,[e("div",Q,[e("div",T,[e("span",G,"بله ("+r(s.value.yesVotes)+" رای)",1),t[9]||(t[9]=o()),e("span",H,r(s.value.yesPercentage)+"%",1)]),t[10]||(t[10]=o()),e("div",J,[e("div",{class:"h-full bg-primary rounded-full transition-all duration-1000 ease-out",style:p({width:`${s.value.yesPercentage}%`})},null,4)])]),t[13]||(t[13]=o()),e("div",K,[e("div",W,[e("span",X,"خیر ("+r(s.value.noVotes)+" رای)",1),t[11]||(t[11]=o()),e("span",Y,r(s.value.noPercentage)+"%",1)]),t[12]||(t[12]=o()),e("div",Z,[e("div",{class:"h-full bg-muted rounded-full transition-all duration-1000 ease-out",style:p({width:`${s.value.noPercentage}%`})},null,4)])])])]),t[20]||(t[20]=o()),e("div",tt,[e("div",et,[e("div",st,r(s.value.totalVotes),1),t[15]||(t[15]=o()),t[16]||(t[16]=e("div",{class:"text-sm text-muted-foreground"},"کل آرا",-1))]),t[19]||(t[19]=o()),e("div",ot,[e("div",nt,r(s.value.yesPercentage)+"%",1),t[17]||(t[17]=o()),t[18]||(t[18]=e("div",{class:"text-sm text-muted-foreground"},"درصد بله",-1))])])])):u.value?f("",!0):(a(),i("div",lt,[...t[21]||(t[21]=[e("div",{class:"w-16 h-16 rounded-xl bg-primary/10 flex items-center justify-center mx-auto mb-4"},[e("i",{class:"ti ti-chart-bar text-primary text-2xl opacity-50"})],-1),o(),e("h3",{class:"text-foreground font-medium mb-2"},"هیچ نظرسنجی فعالی وجود ندارد",-1),o(),e("p",{class:"text-muted-foreground text-sm"},"هنوز نظرسنجی ایجاد نشده است",-1)])]))])])]))}});export{ct as default};
