import{r as i,o as v}from"#entry";const S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAXCAMAAABODP0nAAAAVFBMVEXaAAAjn0D////wkZHkSUme1KtfunRduHOo2bTjRERYtW7xmpriPT2k17DujIzxl5f+9PT96enxnZ30sLBDrVzfJyeKy5nrd3fsfn7tg4P4y8v0s7NKuoUCAAAAkElEQVQoz+WPRxLDMAhFlSBLVrOae+5/zyCcsrAXrBPKvIH/FyBuzBA/ZRyVtlprq9QbloDdoOyhj2LuuxC6nvKF7xw+8yzu58j5Ynk2pr0+9sQwuhpLLQxjWcGtHCNsw7AB58bsfebciF+nq68XBxAhDggAR4jQgI1FAuqLmKSRHkvKBmMaDEHS1hz6JP4ynkIfCksRzajdAAAAAElFTkSuQmCC",k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAVBAMAAADGNLEtAAAALVBMVEX////GU3LZjKGzGUINM2PsxtAYPWotT3hed5enma46WoBPa46zGkMkR3Jrgp+6ntXWAAAAiklEQVQY02Nwc0lJcQMSxghgw+CRVdaWkVXWooQEGFxaPLxKWjxcGJCBn1fJExAWRAJglUuAKlEEPdyXgA1A0e62LTu9bFt2CopF3iCh9LItKE5yX5tVe31tVgmq9pL0NLcy95RQJMAAdiUQo2ifCQUoKrECY0xgw6CEBWDXLogFYBfECrBahM1JAItMTcEiMDpsAAAAAElFTkSuQmCC",B="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAbCAMAAAA5zj1cAAAAQlBMVEUAVDBvnoohakoTYD9bkHkGWDU7e2ACVTFDgWaBq5kmbU95pZJRinFVjXU1d1pLhm2Os6OiwbMtclRkl4EKWje50MYuwG0pAAAAnklEQVQ4y+XTuQ4DMQgEULABj+9r9/9/NV0qK0qRajP1k9AgoEBfJdBDoRJdpD5cpEtTUtJ0HWEraXNp1sCoq0ssUo/QbY3ZyoZUKa5ice9H2GXbkI6SknCrSFHkCCtszlmQMTJ2he98Hg0Doy1nc9y5GXuzcoQ2B3oemfdwbQgyO3feYwruIu+8Nu8V60FHoZ/K+BzfueOUf3iFH8EXincH0Y/Lci4AAAAASUVORK5CYII=",V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAbCAMAAAA5zj1cAAAARVBMVEXjChf70dPqRlDnMDvnLDflIi383N7jCxj////kFCHmJjL4v8Pwe4LvbnbtZW3sUlv+8PHlHSn0naL3trrpO0XyjZPyiZBeDlMuAAAAjUlEQVQ4y+WTyxKDIAwAw0NYQETR9v8/tQenehHl3ObE7OxAQhLx0hVeflZctOkQ/egAlf2DODhQU1zKdC/6BHk/xVvxBfWgw9AUPRAOapNYcy0aUCfVzC5ciwXWLwsVKI2nI7iTbrNTjRtl7sxRRnj3VC2SYP/qYB86o6BuIY65r9er7pse+4c7cyd+AOKjBXOHX0j9AAAAAElFTkSuQmCC",U=()=>{const l=i(!1),c=i(!1),o=i(!1),r=i(void 0),d=async()=>{if(!window.PublicKeyCredential)return l.value=!1,!1;l.value=!0;try{c.value=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch{c.value=!1}return l.value},f=a=>{const n=a.replace(/-/g,"+").replace(/_/g,"/"),s="=".repeat((4-n.length%4)%4),e=atob(n+s),A=new Uint8Array(e.length);for(let t=0;t<e.length;t++)A[t]=e.charCodeAt(t);return A.buffer},u=a=>{const n=new Uint8Array(a);let s="";for(let e=0;e<n.length;e++)s+=String.fromCharCode(n[e]);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},y=async(a,n,s)=>{if(!l.value)return{success:!1,error:"WebAuthn پشتیبانی نمی‌شود"};o.value=!0,r.value=void 0;try{const e=new Uint8Array(32);crypto.getRandomValues(e);const A={challenge:e,rp:{name:"لینکو - Linku",id:window.location.hostname},user:{id:new TextEncoder().encode(a),name:n,displayName:s},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-257}],timeout:6e4,attestation:"none",authenticatorSelection:{authenticatorAttachment:"platform",residentKey:"preferred",requireResidentKey:!1,userVerification:"preferred"}},t=await navigator.credentials.create({publicKey:A});if(!t)throw new Error("ایجاد Credential ناموفق بود");const g=t.response,C={id:t.id,rawId:u(t.rawId),type:t.type,response:{attestationObject:u(g.attestationObject),clientDataJSON:u(g.clientDataJSON)}},p=JSON.parse(localStorage.getItem("webauthn_credentials")||"[]");return p.push({credentialId:t.id,userId:a,createdAt:new Date().toISOString()}),localStorage.setItem("webauthn_credentials",JSON.stringify(p)),localStorage.setItem("webauthn_enabled","true"),o.value=!1,{success:!0,credential:C}}catch(e){return o.value=!1,e.name==="NotAllowedError"?r.value="دسترسی رد شد. لطفاً دوباره تلاش کنید.":e.name==="InvalidStateError"?r.value="این دستگاه قبلاً ثبت شده است.":r.value=e.message||"خطا در ثبت Passkey",{success:!1,error:r.value}}},b=async()=>{if(!l.value)return{success:!1,error:"WebAuthn پشتیبانی نمی‌شود"};if(localStorage.getItem("webauthn_enabled")!=="true")return{success:!1,error:"Passkey فعال نیست"};o.value=!0,r.value=void 0;try{const a=new Uint8Array(32);crypto.getRandomValues(a);const n=JSON.parse(localStorage.getItem("webauthn_credentials")||"[]"),s={challenge:a,timeout:6e4,rpId:window.location.hostname,allowCredentials:n.map(t=>({type:"public-key",id:f(t.credentialId),transports:["internal"]})),userVerification:"preferred"},e=await navigator.credentials.get({publicKey:s});if(!e)throw new Error("احراز هویت ناموفق بود");const A=n.find(t=>t.credentialId===e.id);return o.value=!1,{success:!0,userId:A?.userId,credential:{id:e.id,type:e.type}}}catch(a){return o.value=!1,a.name==="NotAllowedError"?r.value="احراز هویت لغو شد":r.value=a.message||"خطا در احراز هویت",{success:!1,error:r.value}}},h=()=>localStorage.getItem("webauthn_enabled")==="true",m=()=>{localStorage.removeItem("webauthn_enabled"),localStorage.removeItem("webauthn_credentials")},w=()=>JSON.parse(localStorage.getItem("webauthn_credentials")||"[]");return v(()=>{d()}),{isSupported:l,isPlatformAuthenticatorAvailable:c,isLoading:o,error:r,checkSupport:d,registerPasskey:y,authenticateWithPasskey:b,isPasskeyEnabled:h,disablePasskey:m,getRegisteredDevices:w}};export{S as _,k as a,B as b,V as c,U as u};
