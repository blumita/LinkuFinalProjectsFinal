import{j as l,a as i}from"#entry";const x=l("reward",{state:()=>({rewards:[],isLoading:!1,error:null}),getters:{activeRewards:a=>a.rewards.filter(r=>r.status==="active"),expiredRewards:a=>a.rewards.filter(r=>r.status==="expired"),usedRewards:a=>a.rewards.filter(r=>r.status==="used")},actions:{async fetchRewards(){this.isLoading=!0,this.error=null;const{$axios:a}=i(),r=a;try{const t=await r.get("user/discounts");t.data&&t.data.data&&Array.isArray(t.data.data)?this.rewards=t.data.data.map(e=>{let s="active";e.status==="used"||e.used_at?s="used":e.status==="expired"||e.status===0||e.status===!1?s="expired":(e.status==="active"||e.status===1||e.is_active)&&(s="active");const p=e.expiry_date||e.expiryDate||e.expire_at||e.expires_at;return p&&s!=="used"&&new Date(p)<new Date&&(s="expired"),{id:e.id||e.code,title:e.title||e.name||`کد تخفیف ${e.code}`,description:e.description||`تخفیف ${e.percent||e.value||e.amount}${e.type==="percentage"||e.percent?"%":" تومان"}`,code:e.code,value:e.percent||e.value||e.amount||0,type:e.type||(e.percent?"percentage":"fixed"),status:s,expiryDate:p,minAmount:e.min_amount||e.minAmount||e.minimum_amount,maxDiscount:e.max_discount||e.maxDiscount||e.maximum_discount,usageLimit:e.usage_limit||e.usageLimit||e.max_uses,usageCount:e.usage_count||e.usageCount||e.used_count,appliesTo:e.applies_to||e.appliesTo||e.applicable_items,banner:e.banner||e.banner_image||e.image_url||null,image:e.icon||e.image||e.icon_url||null}}):this.rewards=[]}catch(t){this.error=t.message||"خطا در دریافت کدهای تخفیف",this.rewards=[]}finally{this.isLoading=!1}},async applyReward(a,r){const{$axios:t}=i(),e=t;try{return(await e.post("rewards/apply",{code:a,amount:r})).data}catch(s){throw s}},async validateReward(a){const{$axios:r}=i(),t=r;try{return(await t.post("rewards/validate",{code:a})).data}catch(e){throw e}}}});export{x as u};
