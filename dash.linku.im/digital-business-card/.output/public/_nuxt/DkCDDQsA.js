const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D8JGLIeS.js","./CE1G-McA.js"])))=>i.map(i=>d[i]);
import{w as lt,G as ot,a as rt,c as nt,r as i,o as it,L as at,b as d,f as e,e as s,y as T,C as V,t as c,d as I,g as A,Y as dt,E as M,T as P,$ as U,P as $,M as ut,X as F,A as ft,i as a,S as vt,V as mt,Q as xt}from"#entry";import{I as gt}from"./DJY3EWAx.js";import{u as bt}from"./DyClqVU4.js";import{_ as pt}from"./DlAUqK2U.js";const ct={class:"min-h-screen bg-background flex flex-col"},wt={class:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-lg border-b border-border"},yt={class:"flex items-center h-14 px-2 lg:px-6 max-w-4xl mx-auto"},kt={class:"flex-1 text-base lg:text-lg font-semibold text-foreground text-center"},ht={class:"flex-1 pt-16 px-2 lg:px-6 max-w-4xl mx-auto w-full pb-8"},jt={class:"lg:max-w-md lg:mx-auto"},Ct={class:"bg-card border border-border rounded-2xl p-4 mb-6"},It={class:"flex items-center gap-3"},Rt=["src","alt"],zt={class:"flex-1"},St={class:"font-semibold text-foreground text-base"},Dt={class:"flex items-center gap-2 mt-1.5"},Tt=["src"],$t={class:"text-sm text-muted-foreground"},Et={key:0,class:"mb-6 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-6 text-center shadow-lg"},Qt={key:1,class:"mb-6 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-6 text-center shadow-lg"},Nt={class:"text-white/90 text-sm"},Lt={class:"space-y-4"},Vt={key:0,class:"fixed inset-0 z-[9998]"},At={class:"absolute bottom-0 left-0 right-0 bg-background rounded-t-3xl overflow-hidden lg:bottom-auto lg:top-1/2 lg:left-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2 lg:rounded-2xl lg:max-w-md lg:w-full"},Mt={class:"px-6 pb-4 lg:pt-6"},Pt={class:"flex items-center justify-between mb-2"},Ut={class:"px-6 pb-6 space-y-4"},Ot=["disabled"],Bt={key:0,class:"fixed inset-0 z-[9998]"},qt={class:"absolute bottom-0 left-0 right-0 bg-background rounded-t-3xl max-h-[80vh] overflow-hidden lg:bottom-auto lg:top-1/2 lg:left-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2 lg:rounded-2xl lg:max-w-md lg:w-full"},Gt={class:"px-4 pb-3 lg:p-4 lg:border-b lg:border-border"},Ft={class:"flex items-center justify-between"},Ht={class:"px-4 py-3 border-y border-border bg-muted/30"},Jt={class:"flex items-center gap-3"},Kt=["src","alt"],Wt={class:"font-semibold text-foreground text-sm"},Xt={class:"px-4 py-3 max-h-[50vh] overflow-y-auto"},Yt={key:0,class:"text-center py-8"},Zt={key:1,class:"space-y-2"},_t=["onClick"],te=["src","alt"],ee={class:"flex-1 text-right"},se={class:"font-medium text-foreground text-sm"},le={class:"text-xs text-muted-foreground"},oe={class:"p-4 border-t border-border"},re={key:0,class:"fixed inset-0 z-[9999] bg-black flex flex-col"},ne={class:"flex-1 flex items-center justify-center p-6"},ie={class:"relative w-full max-w-xs aspect-square"},ae={__name:"methods",setup(de){const R=lt(),O=ot(),{$axios:H}=rt(),J=bt(),g=nt(()=>J.cards.map(l=>({id:Number(l.id),name:l.userName||"بدون نام",avatar:l.avatar||"/logo.svg",role:l.job||"کاربر"}))),E=i(!1),B=i(""),q=i("ti-alert-triangle"),u=(l,t="ti-lock")=>{B.value=l,q.value=t,E.value=!0,setTimeout(()=>E.value=!1,3e3)},f=i(null),m=i(null),b=i(""),Q=i(!1),z=i(!1),w=i(""),h=i(!1),y=i(!1),p=i(!1),S=i(!1),k=i(null),D=i(null);let j=null,C=null;it(()=>{const l=O.query.device,t=O.query.profile;if(l)try{f.value=JSON.parse(decodeURIComponent(l))}catch{R.push("/dashboard/activate")}else R.push("/dashboard/activate");t&&g.value.length&&(m.value=g.value.find(o=>o.id===Number(t))),!m.value&&g.value.length===1?m.value=g.value[0]:m.value||(p.value=!0)});function K(){R.push("/dashboard/activate")}function W(){R.push("/dashboard")}function X(l){m.value=l,p.value=!1}function Y(l){l&&(l.preventDefault(),l.stopPropagation()),y.value=!0}async function Z(){if(!(!b.value||h.value)){h.value=!0,Q.value=!1,z.value=!1,w.value="";try{const l=await H.post(`v1/cards/${m.value.id}/activateDevice`,{code:b.value,device:f.value});l?.data?.success?(Q.value=!0,y.value=!1,u("محصول با موفقیت فعال شد!","ti-check")):(z.value=!0,w.value=l.data?.message||"کد نامعتبر است",u(w.value,"ti-alert-triangle"))}catch(l){z.value=!0,w.value=l.response?.data?.message||"خطا در فعال‌سازی",u(w.value,"ti-alert-triangle")}finally{h.value=!1}}}async function _(){S.value=!0;try{j=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),await ut(),k.value&&(k.value.srcObject=j,await k.value.play(),tt())}catch{u("دسترسی به دوربین امکان‌پذیر نیست","ti-camera-off"),v()}}function tt(){F(async()=>{const{default:l}=await import("./D8JGLIeS.js").then(t=>t.j);return{default:l}},__vite__mapDeps([0,1]),import.meta.url).then(({default:l})=>{const t=document.createElement("canvas"),o=t.getContext("2d");C=ft(()=>{if(!k.value||!S.value){clearInterval(C);return}const r=k.value;if(r.readyState!==r.HAVE_ENOUGH_DATA)return;t.width=r.videoWidth,t.height=r.videoHeight,o.drawImage(r,0,0,t.width,t.height);const n=o.getImageData(0,0,t.width,t.height),x=l(n.data,n.width,n.height,{inversionAttempts:"dontInvert"});x&&x.data&&G(x.data)},150)}).catch(()=>{u("خطا در بارگذاری اسکنر","ti-alert-triangle"),v()})}function G(l){let t=l.trim();const o=[/linku\.im\/profile\/([a-z0-9]{8})\/[a-z0-9-]+/i,/linku\.im\/([a-z0-9]{8})\/[a-z0-9-]+/i,/linkutag\.com\/([a-z0-9]{8})\/[a-z0-9-]+/i,/activate\/([a-z0-9]+)/i,/license[=\/]([a-z0-9]+)/i,/code[=\/]([a-z0-9]+)/i,/linku\.im\/([a-z0-9]{8})$/i,/linkutag\.com\/([a-z0-9]{8})$/i,/^([a-z0-9]{8})$/i];for(const r of o){const n=t.match(r);if(n&&n[1]){t=n[1];break}}/^[a-z0-9]{6,20}$/i.test(t)?(b.value=t.toLowerCase(),v(),u("کد لایسنس شناسایی شد!","ti-check")):(v(),u("QR کد معتبر نیست","ti-alert-triangle"))}function et(){D.value?.click()}async function st(l){const t=l.target.files?.[0];if(t){try{const{default:o}=await F(async()=>{const{default:n}=await import("./D8JGLIeS.js").then(x=>x.j);return{default:n}},__vite__mapDeps([0,1]),import.meta.url),r=new Image;r.onload=()=>{const n=document.createElement("canvas"),x=n.getContext("2d");n.width=r.width,n.height=r.height,x.drawImage(r,0,0);const N=x.getImageData(0,0,n.width,n.height),L=o(N.data,N.width,N.height);L&&L.data?G(L.data):(v(),u("QR کد در تصویر یافت نشد","ti-alert-triangle"))},r.onerror=()=>{v(),u("خطا در خواندن تصویر","ti-alert-triangle")},r.src=URL.createObjectURL(t)}catch{v(),u("خطا در پردازش تصویر","ti-alert-triangle")}D.value&&(D.value.value="")}}function v(){S.value=!1,C&&(clearInterval(C),C=null),j&&(j.getTracks().forEach(l=>l.stop()),j=null)}return at(()=>{v()}),(l,t)=>(a(),d($,null,[e("div",ct,[e("div",wt,[e("div",yt,[e("button",{onClick:K,class:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-accent transition-colors"},[...t[9]||(t[9]=[e("i",{class:"ti ti-arrow-right text-xl text-foreground"},null,-1)])]),t[10]||(t[10]=s()),e("h1",kt,`\r
          فعال‌سازی `+c(f.value?.name||"محصول"),1),t[11]||(t[11]=s()),t[12]||(t[12]=e("div",{class:"w-10"},null,-1))])]),t[89]||(t[89]=s()),e("div",ht,[e("div",jt,[e("div",Ct,[e("div",It,[e("img",{src:f.value?.image,alt:f.value?.name,class:"w-14 h-14 lg:w-16 lg:h-16 object-contain"},null,8,Rt),t[15]||(t[15]=s()),e("div",zt,[e("h3",St,c(f.value?.name),1),t[14]||(t[14]=s()),e("div",Dt,[e("img",{src:m.value?.avatar,class:"w-6 h-6 rounded-full object-cover"},null,8,Tt),t[13]||(t[13]=s()),e("span",$t,c(m.value?.name),1)])]),t[16]||(t[16]=s()),e("button",{onClick:t[0]||(t[0]=o=>p.value=!0),class:"text-xs text-primary font-medium px-3 py-1.5 rounded-lg hover:bg-primary/10 transition-colors"},`\r
              تغییر\r
            `)])]),t[32]||(t[32]=s()),Q.value?(a(),d("div",Et,[t[17]||(t[17]=e("div",{class:"w-16 h-16 mx-auto mb-4 bg-white/20 rounded-full flex items-center justify-center"},[e("i",{class:"ti ti-circle-check text-white text-4xl"})],-1)),t[18]||(t[18]=s()),t[19]||(t[19]=e("p",{class:"text-white font-bold text-lg mb-2"},"فعال‌سازی موفق!",-1)),t[20]||(t[20]=s()),t[21]||(t[21]=e("p",{class:"text-white/90 text-sm"},"محصول به پروفایل شما متصل شد",-1)),t[22]||(t[22]=s()),e("button",{onClick:W,class:"mt-4 bg-white/20 hover:bg-white/30 text-white px-6 py-2 rounded-lg transition-colors"},`\r
            بازگشت به داشبورد\r
          `)])):I("",!0),t[33]||(t[33]=s()),z.value?(a(),d("div",Qt,[t[23]||(t[23]=e("div",{class:"w-16 h-16 mx-auto mb-4 bg-white/20 rounded-full flex items-center justify-center"},[e("i",{class:"ti ti-alert-circle text-white text-4xl"})],-1)),t[24]||(t[24]=s()),t[25]||(t[25]=e("p",{class:"text-white font-bold text-lg mb-2"},"خطا در فعال‌سازی",-1)),t[26]||(t[26]=s()),e("p",Nt,c(w.value||"کد وارد شده نامعتبر است"),1)])):I("",!0),t[34]||(t[34]=s()),e("div",Lt,[t[29]||(t[29]=e("h3",{class:"text-base font-semibold text-foreground text-center mb-6"},"روش فعال‌سازی را انتخاب کنید",-1)),t[30]||(t[30]=s()),e("button",{onClick:dt(Y,["stop"]),class:"w-full bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all active:scale-[0.98] group"},[...t[27]||(t[27]=[A('<div class="flex items-center gap-4" data-v-90f1c6e3><div class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform" data-v-90f1c6e3><i class="ti ti-key text-3xl" data-v-90f1c6e3></i></div> <div class="flex-1 text-right" data-v-90f1c6e3><h4 class="font-bold text-lg mb-1" data-v-90f1c6e3>کد فعال‌سازی دارم</h4> <p class="text-sm text-white/80" data-v-90f1c6e3>کد روی بسته‌بندی محصول را وارد کنید</p></div> <i class="ti ti-chevron-left text-xl opacity-50" data-v-90f1c6e3></i></div>',1)])]),t[31]||(t[31]=s()),e("button",{onClick:_,class:"w-full bg-gradient-to-br from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all active:scale-[0.98] group"},[...t[28]||(t[28]=[A('<div class="flex items-center gap-4" data-v-90f1c6e3><div class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform" data-v-90f1c6e3><i class="ti ti-qrcode text-3xl" data-v-90f1c6e3></i></div> <div class="flex-1 text-right" data-v-90f1c6e3><h4 class="font-bold text-lg mb-1" data-v-90f1c6e3>محصول رو اسکن می‌کنم</h4> <p class="text-sm text-white/80" data-v-90f1c6e3>QR کد روی محصول را اسکن کنید</p></div> <i class="ti ti-chevron-left text-xl opacity-50" data-v-90f1c6e3></i></div>',1)])])]),t[35]||(t[35]=A(' <div class="mt-8 text-center bg-muted/50 rounded-2xl p-6" data-v-90f1c6e3><i class="ti ti-shopping-bag text-2xl text-muted-foreground mb-2" data-v-90f1c6e3></i> <p class="text-sm text-muted-foreground mb-3" data-v-90f1c6e3>هنوز محصول لینکو ندارید؟</p> <a href="https://linkutag.com/shop" target="_blank" class="inline-flex items-center gap-2 text-primary text-sm font-bold hover:underline" data-v-90f1c6e3><span data-v-90f1c6e3>خرید از فروشگاه لینکو</span> <i class="ti ti-arrow-left text-xs" data-v-90f1c6e3></i></a></div>',2))])]),t[90]||(t[90]=s()),(a(),V(U,{to:"body"},[T(P,{name:"sheet"},{default:M(()=>[y.value?(a(),d("div",Vt,[e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t[1]||(t[1]=o=>y.value=!1)}),t[56]||(t[56]=s()),e("div",At,[t[53]||(t[53]=e("div",{class:"lg:hidden flex justify-center py-3"},[e("div",{class:"w-10 h-1 bg-muted-foreground/30 rounded-full"})],-1)),t[54]||(t[54]=s()),e("div",Mt,[e("div",Pt,[t[37]||(t[37]=e("h3",{class:"text-xl font-bold text-foreground"},"کد فعال‌سازی",-1)),t[38]||(t[38]=s()),e("button",{onClick:t[2]||(t[2]=o=>y.value=!1),class:"w-9 h-9 flex items-center justify-center rounded-lg hover:bg-muted transition-colors"},[...t[36]||(t[36]=[e("i",{class:"ti ti-x text-xl text-muted-foreground"},null,-1)])])]),t[39]||(t[39]=s()),t[40]||(t[40]=e("p",{class:"text-sm text-muted-foreground"},"کد روی بسته‌بندی محصول را وارد کنید",-1))]),t[55]||(t[55]=s()),e("div",Ut,[e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-foreground mb-2"},"کد فعال‌سازی محصول",-1)),t[42]||(t[42]=s()),vt(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>b.value=o),type:"text",dir:"ltr",placeholder:"LNK4781EPS7O",class:"w-full px-4 py-4 bg-muted border-2 border-border rounded-xl text-foreground text-center font-mono text-lg tracking-wider focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all uppercase placeholder:lowercase placeholder:text-muted-foreground/50",onInput:t[4]||(t[4]=o=>b.value=o.target.value.toUpperCase())},null,544),[[mt,b.value]]),t[43]||(t[43]=s()),t[44]||(t[44]=e("p",{class:"text-xs text-muted-foreground mt-2 text-center"},"معمولاً ۸ تا ۱۲ کاراکتر انگلیسی",-1))]),t[51]||(t[51]=s()),e("button",{onClick:Z,disabled:!b.value||h.value,class:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 disabled:from-gray-400 disabled:to-gray-500 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:cursor-not-allowed transition-all shadow-lg disabled:shadow-none"},[h.value?(a(),d($,{key:0},[t[45]||(t[45]=e("div",{class:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"},null,-1)),t[46]||(t[46]=s()),t[47]||(t[47]=e("span",null,"در حال فعال‌سازی...",-1))],64)):(a(),d($,{key:1},[t[48]||(t[48]=e("i",{class:"ti ti-check text-xl"},null,-1)),t[49]||(t[49]=s()),t[50]||(t[50]=e("span",null,"تایید و فعال‌سازی",-1))],64))],8,Ot),t[52]||(t[52]=s()),e("button",{onClick:t[5]||(t[5]=o=>y.value=!1),class:"w-full py-3 rounded-xl border-2 border-border text-foreground font-medium hover:bg-muted transition-colors"},`\r
                انصراف\r
              `)])])])):I("",!0)]),_:1})])),t[91]||(t[91]=s()),(a(),V(U,{to:"body"},[T(P,{name:"sheet"},{default:M(()=>[p.value?(a(),d("div",Bt,[e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t[6]||(t[6]=o=>p.value=!1)}),t[75]||(t[75]=s()),e("div",qt,[t[70]||(t[70]=e("div",{class:"lg:hidden flex justify-center py-3"},[e("div",{class:"w-10 h-1 bg-muted-foreground/30 rounded-full"})],-1)),t[71]||(t[71]=s()),e("div",Gt,[e("div",Ft,[t[58]||(t[58]=e("h3",{class:"text-lg font-bold text-foreground"},"انتخاب پروفایل",-1)),t[59]||(t[59]=s()),e("button",{onClick:t[7]||(t[7]=o=>p.value=!1),class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-muted"},[...t[57]||(t[57]=[e("i",{class:"ti ti-x text-lg text-muted-foreground"},null,-1)])])]),t[60]||(t[60]=s()),t[61]||(t[61]=e("p",{class:"text-xs text-muted-foreground mt-1"},"کدام پروفایل به این محصول متصل شود؟",-1))]),t[72]||(t[72]=s()),e("div",Ht,[e("div",Jt,[e("img",{src:f.value?.image,alt:f.value?.name,class:"w-12 h-12 object-contain"},null,8,Kt),t[64]||(t[64]=s()),e("div",null,[e("h4",Wt,c(f.value?.name),1),t[62]||(t[62]=s()),t[63]||(t[63]=e("p",{class:"text-xs text-muted-foreground"},"محصول انتخاب شده",-1))])])]),t[73]||(t[73]=s()),e("div",Xt,[!g.value||g.value.length===0?(a(),d("div",Yt,[...t[65]||(t[65]=[e("i",{class:"ti ti-user-off text-3xl text-muted-foreground mb-2"},null,-1),s(),e("p",{class:"text-muted-foreground text-sm"},"پروفایلی یافت نشد",-1)])])):(a(),d("div",Zt,[(a(!0),d($,null,xt(g.value,o=>(a(),d("button",{key:o.id,onClick:r=>X(o),class:"w-full bg-card border border-border rounded-xl p-3 flex items-center gap-3 hover:border-primary/50 hover:bg-accent/50 transition-all active:scale-[0.98]"},[e("img",{src:o.avatar,alt:o.name,class:"w-10 h-10 rounded-full object-cover border-2 border-border"},null,8,te),t[67]||(t[67]=s()),e("div",ee,[e("h4",se,c(o.name),1),t[66]||(t[66]=s()),e("p",le,c(o.role),1)]),t[68]||(t[68]=s()),t[69]||(t[69]=e("i",{class:"ti ti-chevron-left text-muted-foreground"},null,-1))],8,_t))),128))]))]),t[74]||(t[74]=s()),e("div",oe,[e("button",{onClick:t[8]||(t[8]=o=>p.value=!1),class:"w-full py-3 rounded-xl border border-border text-foreground font-medium hover:bg-muted transition-colors"},`\r
                انصراف\r
              `)])])])):I("",!0)]),_:1})])),t[92]||(t[92]=s()),(a(),V(U,{to:"body"},[T(P,{name:"fade"},{default:M(()=>[S.value?(a(),d("div",re,[e("div",{class:"flex items-center justify-between p-4 bg-gradient-to-b from-black/80 to-transparent absolute top-0 left-0 right-0 z-10"},[e("button",{onClick:v,class:"w-10 h-10 rounded-full bg-white/10 backdrop-blur-lg flex items-center justify-center"},[...t[76]||(t[76]=[e("i",{class:"ti ti-x text-white text-xl"},null,-1)])]),t[78]||(t[78]=s()),t[79]||(t[79]=e("span",{class:"text-white font-medium"},"اسکن QR کد",-1)),t[80]||(t[80]=s()),e("button",{onClick:et,class:"w-10 h-10 rounded-full bg-white/10 backdrop-blur-lg flex items-center justify-center"},[...t[77]||(t[77]=[e("i",{class:"ti ti-photo text-white text-xl"},null,-1)])])]),t[85]||(t[85]=s()),e("div",ne,[e("div",ie,[e("video",{ref_key:"videoElement",ref:k,class:"w-full h-full object-cover rounded-3xl",playsinline:"",autoplay:"",muted:""},null,512),t[81]||(t[81]=s()),t[82]||(t[82]=e("div",{class:"absolute inset-4 border-2 border-white/30 rounded-2xl pointer-events-none"},[e("div",{class:"absolute -top-0.5 -left-0.5 w-8 h-8 border-t-4 border-l-4 border-primary rounded-tl-xl"}),s(),e("div",{class:"absolute -top-0.5 -right-0.5 w-8 h-8 border-t-4 border-r-4 border-primary rounded-tr-xl"}),s(),e("div",{class:"absolute -bottom-0.5 -left-0.5 w-8 h-8 border-b-4 border-l-4 border-primary rounded-bl-xl"}),s(),e("div",{class:"absolute -bottom-0.5 -right-0.5 w-8 h-8 border-b-4 border-r-4 border-primary rounded-br-xl"})],-1)),t[83]||(t[83]=s()),t[84]||(t[84]=e("div",{class:"absolute left-6 right-6 h-0.5 bg-gradient-to-r from-transparent via-primary to-transparent animate-scan"},null,-1))])]),t[86]||(t[86]=s()),t[87]||(t[87]=e("div",{class:"p-6 pb-10 text-center bg-gradient-to-t from-black/80 to-transparent"},[e("p",{class:"text-white font-medium mb-2"},"QR کد محصول را اسکن کنید"),s(),e("p",{class:"text-white/60 text-sm"},"کد روی بسته‌بندی یا پشت محصول قرار دارد")],-1)),t[88]||(t[88]=s()),e("input",{ref_key:"galleryInput",ref:D,type:"file",accept:"image/*",class:"hidden",onChange:st},null,544)])):I("",!0)]),_:1})]))]),t[93]||(t[93]=s()),T(gt,{visible:E.value,message:B.value,icon:q.value},null,8,["visible","message","icon"])],64))}},xe=pt(ae,[["__scopeId","data-v-90f1c6e3"]]);export{xe as default};
