import{d as x}from"./CU4qPF7-.js";import{a as k,c as D,n as o}from"#entry";import{r as l,d as p}from"./Ct89Yiyn.js";const I=(a,i)=>a==="subscription"&&i==="renewal_reminder"?[{label:"تمدید اشتراک",type:"primary",action:()=>o("/dashboard/upgrade")},{label:"بعداً یادآوری کن",type:"secondary",action:()=>{}}]:a==="subscription"&&i==="subscription_expired"?[{label:"تمدید فوری",type:"primary",action:()=>o("/dashboard/upgrade")}]:a==="subscription"&&i==="welcome"?[{label:"ایجاد پروفایل",type:"primary",action:()=>o("/dashboard/add-card")}]:a==="payment"&&i==="payment_warning"||i==="purchase_success"?[{label:"تمدید فوری",type:"primary",action:()=>o("/dashboard/upgrade")}]:a==="security"&&i==="new_login"?[{label:"این من بودم",type:"secondary",action:()=>{}},{label:"امنیت حساب",type:"primary",action:()=>o("/dashboard/settings")}]:a==="general"&&i==="login"?[{label:"مشاهده جزئیات",type:"secondary",action:()=>o("/dashboard/settings")}]:[],P=x("notifications",()=>{const a=l([]),i=l("all"),c=l(!1),s=l(null),d=l(0),{$axios:y}=k(),u=y,f=async(t=!1)=>{t||(c.value=!0);try{const{data:r}=await u.get("user/notifications",{params:{per_page:100,page:1}});if(!r||!r.notifications||!Array.isArray(r.notifications)){a.value=[];return}const n=r.notifications.map(e=>({id:e.id,type:e.type||"general",rawType:e.raw_type||"unknown",title:e.title||"اطلاعیه",description:e.message||"",createdAt:e.created_at?new Date(e.created_at):new Date,read:!!e.read_at,actions:I(e.type||"general",e.raw_type||"unknown")})),A=n.length>a.value.length||n.some(e=>!a.value.find(N=>N.id===e.id));a.value=n,d.value=Date.now(),A&&d.value>0&&v()}catch(r){console.error("Error fetching notifications:",r),a.value=[]}finally{t||(c.value=!1)}},v=()=>{try{const t=new Audio("/notification-sound.mp3");t.volume=.3,t.play().catch(()=>{})}catch{}},g=(t=15e3)=>{s.value||(s.value=D(()=>{f(!0)},t))},m=()=>{s.value&&(clearInterval(s.value),s.value=null)},h=p(()=>i.value==="all"?a.value:a.value.filter(t=>t.type===i.value)),b=async t=>{const r=a.value.find(n=>n.id===t);if(r&&!r.read){r.read=!0;try{await u.post(`user/notifications/${t}/read`)}catch{r.read=!1}}},w=async()=>{a.value.forEach(t=>t.read=!0),await u.post("user/notifications/readAll")},_=p(()=>a.value.filter(t=>!t.read).length);return{notifications:a,filteredNotifications:h,activeFilter:i,loading:c,unreadCount:_,fetchNotifications:f,markAsRead:b,markAllAsRead:w,startPolling:g,stopPolling:m}});export{P as u};
