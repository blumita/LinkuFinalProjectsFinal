import{_ as be}from"./DUksgA9l.js";import{r as a,d as T,w as ge,j as ce,a1 as ye,k as d,q as t,p as o,F as z,u as b,v as s,l as v,N as C,V as j,M,a2 as ke,I as O,T as Y,i as _,Q as P,x as i,O as ee,R as te,a0 as we}from"./Ct89Yiyn.js";import{I as Ce}from"./DGzIcDwE.js";import{useUserStore as he}from"./BRBG3GYJ.js";import{d as Be,c as D}from"./Cr5Iw68y.js";import{b as Ie,a as Ue}from"#entry";import{_ as $e}from"./DlAUqK2U.js";import"./CU4qPF7-.js";import"./lVmvsOkf.js";import"./ngrFHoWO.js";const Ve={class:"min-h-screen bg-background"},je={class:"fixed top-0 left-0 right-0 w-full z-50 bg-card/95 backdrop-blur-lg border-b border-border safe-area-top"},Te={class:"flex items-center justify-between px-3 py-2.5"},ze={class:"flex items-center gap-3"},Me={class:"pt-14 pb-24 px-3"},Pe={class:"space-y-3"},Ee={class:"bg-card rounded-2xl p-4 shadow-sm border border-border/50"},Le={class:"bg-muted/30 rounded-xl p-3 border border-border mb-3"},Re={class:"flex items-center justify-between"},Se={class:"flex-1 min-w-0"},Ne={class:"text-sm text-foreground font-mono truncate"},Fe={class:"flex items-center border border-border rounded-xl bg-background px-3 py-3 ltr relative"},Oe={key:0,class:"absolute ltr:left-3 rtl:right-3 top-1/2 -translate-y-1/2"},De={key:0,class:"ti ti-check text-green-600 text-lg"},Ke={key:1,class:"ti ti-x text-red-500 text-lg"},qe={key:2,class:"ti ti-loader-2 text-primary animate-spin text-lg"},Ae={key:0,class:"text-[10px] text-red-600 mt-1"},Qe={key:1,class:"text-[10px] text-red-600 mt-1"},We={class:"bg-card rounded-2xl p-4 shadow-sm space-y-3 border border-border/50"},Ze={class:"mb-2"},Ge=["src","alt"],He={class:"flex-1 text-right text-foreground text-sm"},Je={class:"text-muted-foreground text-xs mx-2",dir:"ltr"},Xe={class:"bg-card rounded-2xl p-4 shadow-sm border border-border/50"},Ye={class:"flex items-center justify-between gap-3"},_e={class:"fixed bottom-0 left-0 right-0 z-40 bg-card/95 backdrop-blur-lg border-t border-border safe-area-bottom"},et={class:"px-4 py-3 flex gap-3"},tt=["disabled"],ot=["disabled"],rt={key:0,class:"ti ti-loader-2 animate-spin"},st={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},lt={class:"relative bg-card rounded-2xl shadow-xl p-6 w-full max-w-sm z-50 text-center space-y-5 mx-4 border border-border"},nt={class:"text-sm text-muted-foreground"},at={class:"flex justify-center gap-2 ltr"},dt=["onUpdate:modelValue","onInput","onKeydown"],it={class:"text-xs text-muted-foreground mt-2"},ut={key:0,class:"text-xs text-red-600"},mt={key:1,class:"text-xs text-green-600"},ft={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},pt={class:"relative bg-card rounded-2xl shadow-xl p-6 w-full max-w-md z-50 text-center space-y-5 border border-border"},vt={class:"flex flex-col gap-3 pt-2"},xt={class:"px-4 pb-4"},bt={class:"relative mb-4"},gt={class:"max-h-[50vh] overflow-y-auto space-y-1"},ct=["onClick","disabled"],yt=["src","alt"],kt={class:"flex-1 text-right"},wt={class:"text-foreground font-medium"},Ct={class:"text-xs text-muted-foreground"},ht={class:"text-muted-foreground text-sm",dir:"ltr"},Bt={key:0,class:"ti ti-check text-primary"},It={key:1,class:"text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded"},Ut={__name:"CustomizeLinkPage",setup($t){const oe=Ie(),{$axios:E}=Ue(),h=he(),l=a({username:"",email:"",phone:"",countryCode:"",removeBranding:!1}),f=a({}),g=a(!1),K=a(""),m=a(null);let q=null;const L=a(!1),B=a(!1),I=a(!1),p=a({...Be}),k=a(""),x=a(["","","",""]),U=a(!1),$=a(!1),R=a([]),A=a(120);let S=null;const N=a(!1),F=a(!1),Q=a(""),W=a("ti-alert-triangle"),V=a(!1),Z=T(()=>h.user?.isPro),G=T(()=>l.value.username!==f.value.username||l.value.email!==f.value.email||l.value.phone!==f.value.phone||l.value.removeBranding!==f.value.removeBranding),H=T(()=>`linku.im/${l.value.username||"username"}`),re=T(()=>{if(!k.value)return D;const r=k.value.toLowerCase();return D.filter(e=>e.name.includes(r)||e.nameEn.toLowerCase().includes(r)||e.dialCode.includes(r))});ge(()=>h.user,r=>{if(r&&(l.value.username=r.username||"",l.value.email=r.email||"",l.value.phone=r.phone||"",l.value.countryCode=r.countryCode||"",l.value.removeBranding=!!r.removeBranding,f.value={...l.value},r.countryCode)){const e=r.countryCode.startsWith("+")?r.countryCode:"+"+r.countryCode,u=D.find(n=>n.dialCode===e);u&&(p.value=u)}},{immediate:!0}),ce(()=>{f.value={...l.value}}),ye(()=>{clearInterval(S)});function J(r){return r.replace(/[۰-۹]/g,e=>"۰۱۲۳۴۵۶۷۸۹".indexOf(e)).replace(/[^\d]/g,"")}function se(r){p.value=r,l.value.countryCode=r.dialCode,I.value=!1,k.value=""}function c(r,e="ti-lock"){Q.value=r,W.value=e,F.value=!0,setTimeout(()=>F.value=!1,3e3)}function le(){l.value.username=l.value.username.replace(/[^\x00-\x7F]/g,""),l.value.username.length>7&&(l.value.username=l.value.username.slice(0,7)),clearTimeout(q);const r=l.value.username.trim();if(g.value=!/^[a-zA-Z0-9]{3,7}$/.test(r),g.value){m.value=null;return}m.value="checking",q=setTimeout(async()=>{try{const e=await E.get("user/checkUsername",{params:{username:r}});m.value=e.data.available?"available":"taken"}catch(e){console.error(e),m.value="error"}},500)}function ne(){if(l.value.removeBranding){if(Z.value)return;l.value.removeBranding=!1,B.value=!0}}function ae(){l.value={...f.value},m.value=null,g.value=!1,N.value=!1}async function de(){V.value=!0;try{const r={username:l.value.username,email:l.value.email};N.value&&(r.phone=ie(l.value.phone)),r.removeBranding=l.value.removeBranding;const e=await E.put("user/update",r);f.value={...l.value},m.value=null,g.value=!1,K.value="",c(e.data.message,"ti-check"),h.user.userName=l.value.username,h.user.email=l.value.email,h.user.phone=l.value.phone}catch(r){if(r.response&&r.response.data){const{message:e,errors:u}=r.response.data;u?.username&&(m.value="taken",g.value=!0),u?.phone&&(K.value=u.phone[0]),c(e||"خطایی در ذخیره‌سازی رخ داد.","ti-alert-triangle")}else c("خطای شبکه یا ارتباط با سرور!","ti-alert-triangle")}finally{V.value=!1}}function ie(r){if(!r)return"";const u=J(r.toString().trim()).replace(/\s/g,"").replace(/^0/,"");return p.value.dialCode.replace("+","")+u}function ue(){B.value=!1,oe.push("/dashboard/upgrade")}function me(){navigator.clipboard.writeText(H.value),c("لینک کپی شد","ti-check")}function X(){L.value=!1,x.value=["","","",""],U.value=!1,$.value=!1,clearInterval(S),l.value.phone=f.value.phone}function fe(r){const e=x.value[r];if(!/^\d$/.test(e)){x.value[r]="";return}r<x.value.length-1&&R.value[r+1]?.focus()}function pe(r){x.value[r]===""&&r>0&&R.value[r-1]?.focus()}async function ve(){const r=x.value.join(""),e=J(l.value.phone||"").replace(/\s/g,"").replace(/^0/,"");try{const u=await E.post("auth/verifyPhoneChange",{code:r,phone:e,countryCode:p.value.dialCode.replace("+","")});u.data?.success===!0?($.value=!0,U.value=!1,c("شماره با موفقیت تأیید شد.","ti-check"),clearInterval(S),L.value=!1,f.value.phone=l.value.phone,N.value=!0):($.value=!1,U.value=!0,c(u.data.message||"کد وارد شده نادرست است.","ti-alert-triangle"))}catch(u){$.value=!1,U.value=!0;const n=u.response?.data?.message||"خطایی در بررسی کد تأیید رخ داد.";c(n,"ti-alert-triangle")}}function xe(r){const e=Math.floor(r/60),u=r%60;return`${e}:${u<10?"0":""}${u}`}return(r,e)=>{const u=be;return i(),d(P,null,[t("div",Ve,[t("div",je,[t("div",Te,[t("div",ze,[t("button",{onClick:e[0]||(e[0]=n=>r.$router.back()),class:"w-9 h-9 rounded-full bg-muted flex items-center justify-center text-foreground hover:bg-primary/10 hover:text-primary transition-all duration-200"},[...e[10]||(e[10]=[t("i",{class:"ti ti-arrow-right text-lg"},null,-1)])]),e[11]||(e[11]=o()),e[12]||(e[12]=t("h1",{class:"text-base font-semibold text-foreground"},"تنظیمات حساب",-1))])])]),e[65]||(e[65]=o()),t("div",Me,[t("div",Pe,[t("div",Ee,[e[24]||(e[24]=t("h3",{class:"text-sm font-semibold text-foreground mb-3 flex items-center"},[t("i",{class:"ti ti-link text-primary text-lg ml-2"}),o(`\r
            آدرس پروفایل\r
          `)],-1)),e[25]||(e[25]=o()),t("div",Le,[t("div",Re,[t("div",Se,[e[13]||(e[13]=t("div",{class:"text-xs text-muted-foreground mb-0.5"},"لینک فعلی:",-1)),e[14]||(e[14]=o()),t("div",Ne,b(s(H)),1)]),e[16]||(e[16]=o()),t("button",{onClick:me,class:"w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center hover:bg-primary/20 transition-colors shrink-0 mr-2"},[...e[15]||(e[15]=[t("i",{class:"ti ti-copy text-primary text-base"},null,-1)])])])]),e[26]||(e[26]=o()),t("div",null,[e[20]||(e[20]=t("label",{class:"text-xs font-medium text-foreground mb-1.5 block"},"یوزرنیم جدید",-1)),e[21]||(e[21]=o()),t("div",Fe,[e[17]||(e[17]=t("span",{class:"text-muted-foreground opacity-60 text-sm"},"linku.im/",-1)),e[18]||(e[18]=o()),C(t("input",{type:"text",class:"bg-transparent flex-1 focus:outline-none text-foreground text-sm","onUpdate:modelValue":e[1]||(e[1]=n=>s(l).username=n),placeholder:"username",onInput:le,maxlength:"7"},null,544),[[j,s(l).username]]),e[19]||(e[19]=o()),s(m)?(i(),d("div",Oe,[s(m)==="available"?(i(),d("i",De)):s(m)==="taken"?(i(),d("i",Ke)):s(m)==="checking"?(i(),d("i",qe)):v("",!0)])):v("",!0)]),e[22]||(e[22]=o()),s(g)?(i(),d("p",Ae,`\r
              نام کاربری باید ۳ تا ۷ کاراکتر و فقط حروف انگلیسی و عدد باشد.\r
            `)):v("",!0),e[23]||(e[23]=o()),s(m)==="taken"?(i(),d("p",Qe,`\r
              این نام کاربری قبلاً ثبت شده است.\r
            `)):v("",!0)])]),e[43]||(e[43]=o()),t("div",We,[e[36]||(e[36]=t("h3",{class:"text-sm font-semibold text-foreground mb-3 flex items-center"},[t("i",{class:"ti ti-address-book text-primary text-lg ml-2"}),o(`\r
            اطلاعات تماس\r
          `)],-1)),e[37]||(e[37]=o()),t("div",null,[e[27]||(e[27]=t("label",{class:"text-xs font-medium text-foreground mb-1.5 block"},"ایمیل",-1)),e[28]||(e[28]=o()),C(t("input",{type:"email",class:"w-full border border-border rounded-xl px-3 py-3 focus:outline-none bg-muted/50 text-muted-foreground text-sm cursor-not-allowed","onUpdate:modelValue":e[2]||(e[2]=n=>s(l).email=n),disabled:"",readonly:"",placeholder:"email@example.com"},null,512),[[j,s(l).email]])]),e[38]||(e[38]=o()),t("div",null,[e[33]||(e[33]=t("label",{class:"text-xs font-medium text-foreground mb-1.5 block"},"شماره موبایل",-1)),e[34]||(e[34]=o()),t("div",Ze,[t("button",{onClick:e[3]||(e[3]=n=>I.value=!0),class:"w-full flex items-center border border-border rounded-xl px-3 py-3 bg-background transition-all duration-300 hover:border-primary"},[t("img",{src:`/flag/${s(p).flag}.svg`,alt:s(p).nameEn,class:"w-6 h-4 object-cover rounded ml-2"},null,8,Ge),e[29]||(e[29]=o()),t("span",He,b(s(p).name),1),e[30]||(e[30]=o()),t("span",Je,b(s(p).dialCode),1),e[31]||(e[31]=o()),e[32]||(e[32]=t("i",{class:"ti ti-chevron-down text-muted-foreground text-sm"},null,-1))])]),e[35]||(e[35]=o()),C(t("input",{type:"tel",class:"w-full border border-border rounded-xl px-3 py-3 focus:outline-none bg-muted/50 text-muted-foreground text-sm cursor-not-allowed","onUpdate:modelValue":e[4]||(e[4]=n=>s(l).phone=n),disabled:"",readonly:"",placeholder:"۹۱۲ ۰۰۰ ۰۰۰۰",dir:"ltr"},null,512),[[j,s(l).phone]])])]),e[44]||(e[44]=o()),t("div",Xe,[t("div",Ye,[e[41]||(e[41]=t("div",{class:"flex flex-col flex-1 min-w-0"},[t("span",{class:"text-sm font-medium text-foreground"},"حذف برندینگ لینکو"),o(),t("span",{class:"text-[10px] text-muted-foreground"},`\r
                حذف لوگو لینکو از حساب کاربری\r
              `)],-1)),e[42]||(e[42]=o()),t("label",{class:M(["inline-flex relative items-center shrink-0",s(Z)?"cursor-pointer":"cursor-not-allowed opacity-60"])},[C(t("input",{type:"checkbox",class:"sr-only","onUpdate:modelValue":e[5]||(e[5]=n=>s(l).removeBranding=n),onChange:ne},null,544),[[ke,s(l).removeBranding]]),e[39]||(e[39]=o()),t("div",{class:M(["w-10 h-5 rounded-full transition-colors duration-300 border",s(l).removeBranding?"accent-bg border-accent":"bg-gray-300 dark:bg-gray-600 border-gray-300 dark:border-gray-600"])},null,2),e[40]||(e[40]=o()),t("div",{class:M(["absolute top-0.5 w-4 h-4 bg-white rounded-full shadow-md transition-transform duration-300",s(l).removeBranding?"ltr:right-0.5 rtl:left-0.5":"ltr:right-5 rtl:left-5"])},null,2)],2)])])])]),e[66]||(e[66]=o()),t("div",_e,[t("div",et,[t("button",{onClick:ae,class:"flex-1 px-4 py-3 rounded-xl border border-border text-foreground font-medium hover:bg-secondary transition-colors disabled:opacity-40",disabled:!s(G)},`\r
          انصراف\r
        `,8,tt),e[45]||(e[45]=o()),t("button",{onClick:de,class:"flex-1 px-4 py-3 rounded-xl bg-primary text-primary-foreground font-medium hover:opacity-90 transition-colors disabled:opacity-40 flex items-center justify-center gap-2",disabled:!s(G)||s(g)||s(V)},[s(V)?(i(),d("i",rt)):v("",!0),o(" "+b(s(V)?"ذخیره...":"ذخیره تغییرات"),1)],8,ot)])]),e[67]||(e[67]=o()),z(Y,{name:"fade"},{default:O(()=>[s(L)?(i(),d("div",st,[t("div",{class:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:ee(X,["self"])}),e[56]||(e[56]=o()),t("div",lt,[e[49]||(e[49]=t("h2",{class:"text-xl font-bold text-foreground"},"کد تأیید",-1)),e[50]||(e[50]=o()),t("p",nt,[e[46]||(e[46]=o(`\r
            کدی که به `,-1)),t("strong",null,b(s(l).phone),1),e[47]||(e[47]=o(` ارسال شده را وارد کنید.\r
          `,-1))]),e[51]||(e[51]=o()),t("div",at,[(i(!0),d(P,null,te(s(x).length,(n,y)=>C((i(),d("input",{key:y,ref_for:!0,ref:w=>s(R)[y]=w,"onUpdate:modelValue":w=>s(x)[y]=w,type:"text",inputmode:"numeric",maxlength:"1",pattern:"[0-9]*",class:"w-12 h-12 text-xl text-center border border-border rounded-lg font-bold text-foreground bg-background",dir:"ltr",onInput:w=>fe(y),onKeydown:we(w=>pe(y,w),["backspace"])},null,40,dt)),[[j,s(x)[y]]])),128))]),e[52]||(e[52]=o()),t("p",it,b(s(A)>0?`مانده تا ارسال مجدد: ${xe(s(A))}`:"ارسال مجدد فعال شد."),1),e[53]||(e[53]=o()),s(U)?(i(),d("p",ut,"کد وارد شده نادرست است.")):v("",!0),e[54]||(e[54]=o()),s($)?(i(),d("p",mt,"شماره موبایل تأیید شد.")):v("",!0),e[55]||(e[55]=o()),t("div",{class:"flex flex-col sm:flex-row justify-center gap-3 pt-2"},[t("button",{onClick:X,class:"w-full sm:w-auto px-4 py-2 rounded-lg border border-border text-foreground bg-background hover:bg-secondary order-2 sm:order-1"},`\r
              انصراف\r
            `),e[48]||(e[48]=o()),t("button",{onClick:ve,class:"w-full sm:w-auto px-4 py-2 rounded-lg accent-bg accent-text hover:opacity-90 order-1 sm:order-2"},`\r
              تأیید\r
            `)])])])):v("",!0)]),_:1}),e[68]||(e[68]=o()),z(Y,{name:"fade"},{default:O(()=>[s(B)?(i(),d("div",ft,[t("div",{class:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e[6]||(e[6]=ee(n=>B.value=!1,["self"]))}),e[64]||(e[64]=o()),t("div",pt,[e[58]||(e[58]=t("div",{class:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto"},[t("i",{class:"ti ti-crown text-2xl text-yellow-600"})],-1)),e[59]||(e[59]=o()),e[60]||(e[60]=t("h2",{class:"text-xl font-bold text-foreground"},"ارتقا به اشتراک پرو",-1)),e[61]||(e[61]=o()),e[62]||(e[62]=t("p",{class:"text-sm text-muted-foreground"},`\r
            برای حذف برندینگ لینکو و دسترسی به امکانات ویژه، نیاز به اشتراک پرو دارید.\r
          `,-1)),e[63]||(e[63]=o()),t("div",vt,[t("button",{onClick:ue,class:"w-full px-4 py-3 rounded-lg bg-gradient-to-r from-yellow-400 to-yellow-600 text-white font-medium hover:opacity-90 transition-opacity"},`\r
              مشاهده پلان‌های اشتراک\r
            `),e[57]||(e[57]=o()),t("button",{onClick:e[7]||(e[7]=n=>B.value=!1),class:"w-full px-4 py-2 rounded-lg border border-border text-foreground bg-background hover:bg-secondary transition-colors"},`\r
              بعداً\r
            `)])])])):v("",!0)]),_:1})]),e[76]||(e[76]=o()),z(Ce,{visible:s(F),message:s(Q),icon:s(W)},null,8,["visible","message","icon"]),e[77]||(e[77]=o()),z(u,{modelValue:s(I),"onUpdate:modelValue":e[9]||(e[9]=n=>_(I)?I.value=n:null),title:"انتخاب کشور",size:"lg","desktop-width":"2xl",closable:!0,"close-on-backdrop":!0},{default:O(()=>[t("div",xt,[t("div",bt,[e[69]||(e[69]=t("i",{class:"ti ti-search absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"},null,-1)),e[70]||(e[70]=o()),C(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>_(k)?k.value=n:null),type:"text",placeholder:"جستجو کشور...",class:"w-full pr-10 pl-4 py-3 border border-border rounded-lg bg-card text-foreground focus:outline-none focus:border-primary"},null,512),[[j,s(k)]])]),e[75]||(e[75]=o()),t("div",gt,[(i(!0),d(P,null,te(s(re),n=>(i(),d("button",{key:n.code,onClick:y=>n.code==="IR"?se(n):null,disabled:n.code!=="IR",class:M(["w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all",s(p).code===n.code?"bg-primary/10 border border-primary":n.code==="IR"?"hover:bg-accent cursor-pointer":"opacity-50 cursor-not-allowed"])},[t("img",{src:`/flag/${n.flag}.svg`,alt:n.nameEn,class:"w-7 h-5 object-cover rounded"},null,8,yt),e[72]||(e[72]=o()),t("div",kt,[t("div",wt,b(n.name),1),e[71]||(e[71]=o()),t("div",Ct,b(n.nameEn),1)]),e[73]||(e[73]=o()),t("span",ht,b(n.dialCode),1),e[74]||(e[74]=o()),n.code==="IR"?(i(),d(P,{key:0},[s(p).code===n.code?(i(),d("i",Bt)):v("",!0)],64)):(i(),d("span",It,"به‌زودی"))],10,ct))),128))])])]),_:1},8,["modelValue"])],64)}}},Nt=$e(Ut,[["__scopeId","data-v-1fd7eb8b"]]);export{Nt as default};
