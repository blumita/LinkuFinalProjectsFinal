import{j as u,a as i}from"#entry";const h=u("plan",{state:()=>({plans:[],selectedPlanId:12,features:[],loading:!1,error:null}),getters:{selectedPlan(e){return e.plans.find(t=>Number(t.id)===Number(e.selectedPlanId))||null}},actions:{async fetchPlans(){this.loading=!0,this.error=null;const{$axios:e}=i(),t=e;try{const a=await t.get("plan/list");this.plans=a.data.data||a.data;const r=this.plans.find(s=>s.highlight)||this.plans[0];r&&(this.selectedPlanId=r.id,this.features=Array.isArray(r.features)?r.features:JSON.parse(r.features||"[]"))}catch(a){this.error=a}finally{this.loading=!1}},selectPlan(e){this.selectedPlanId=e;const t=this.plans.find(a=>Number(a.id)===Number(e));t&&(this.features=Array.isArray(t.features)?t.features:JSON.parse(t.features||"[]"))},async purchasePlan(e,t="card"){this.loading=!0,this.error=null;const{$axios:a}=i(),r=a;try{const s=this.plans.find(o=>Number(o.id)===Number(e));if(!s)throw new Error("پلن یافت نشد");const l=Math.round(s.price*(1-s.discount/100)),n=(await r.post("/payment",{planId:e,amount:l*10,discountCode:"",metadata:{planTitle:s.title,duration:s.duration},gateway:"zarinpal"})).data?.data?.redirect_url;return n?(window.location.href=n,{success:!0,payment_url:n}):{success:!1,error:"لینک پرداخت دریافت نشد"}}catch(s){return this.error=s,{success:!1,error:s.response?.data?.message||"خطا در پردازش پرداخت"}}finally{this.loading=!1}}}});export{h as u};
