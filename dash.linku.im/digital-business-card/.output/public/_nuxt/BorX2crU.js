import{w as R,r as d,c as N,a as M,o as z,b as r,i as n,f as e,e as s,y as h,C as E,t as a,P as m,Q as x,g as F,E as J,d as O,T as U,$ as Q,k as q}from"#entry";import{I as G}from"./DJY3EWAx.js";import{u as H}from"./DyClqVU4.js";import{_ as K}from"./DlAUqK2U.js";const W={class:"min-h-screen bg-background flex flex-col"},X={class:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-lg border-b border-border"},Y={class:"flex items-center h-14 px-2 lg:px-6 max-w-4xl mx-auto"},Z={class:"flex-1 text-base lg:text-lg font-semibold text-foreground text-center"},tt={class:"flex-1 pt-16 px-2 lg:px-6 max-w-4xl mx-auto w-full pb-8"},et={key:0,class:"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-3"},st={key:1,class:"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-3"},ot=["onClick"],lt=["src","alt"],nt={class:"text-xs lg:text-xs font-medium text-foreground line-clamp-2"},rt={key:2,class:"mt-6 lg:mt-8 space-y-3"},dt={key:3,class:"mt-6 lg:mt-8"},at={class:"flex items-center gap-2 mb-3 lg:mb-4"},it={class:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full"},ut={class:"space-y-2 lg:space-y-3"},gt=["src","alt"],mt={class:"flex-1 min-w-0"},vt={class:"font-medium text-foreground text-xs lg:text-sm"},ct={class:"text-[10px] lg:text-xs text-muted-foreground font-mono truncate"},xt={class:"text-[10px] lg:text-xs text-muted-foreground"},ft=["onClick"],bt={key:4,class:"mt-6 lg:mt-8 bg-card border border-dashed border-border rounded-xl p-6 lg:p-8 text-center"},pt={key:0,class:"fixed inset-0 z-[9998]"},yt={class:"absolute bottom-0 left-0 right-0 bg-background rounded-t-3xl max-h-[80vh] overflow-hidden lg:bottom-auto lg:top-1/2 lg:left-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2 lg:rounded-2xl lg:max-w-md lg:w-full"},wt={class:"px-4 pb-3 lg:p-4 lg:border-b lg:border-border"},kt={class:"flex items-center justify-between"},ht={class:"px-4 py-3 border-y border-border bg-muted/30"},Ct={class:"flex items-center gap-3"},St=["src","alt"],$t={class:"font-semibold text-foreground text-sm"},Nt={class:"px-4 py-3 max-h-[50vh] overflow-y-auto"},Dt={key:0,class:"text-center py-8"},Pt={key:1,class:"space-y-2"},_t=["onClick"],jt=["src","alt"],Tt={class:"flex-1 text-right"},It={class:"font-medium text-foreground text-sm"},At={class:"text-xs text-muted-foreground"},Bt={class:"p-4 border-t border-border"},Vt={__name:"CardList",setup(D){const v=R(),b=d([]),P=H(),c=N(()=>P.cards.map(l=>({id:Number(l.id),name:l.userName||"بدون نام",avatar:l.avatar||"/logo.svg",role:l.job||"کاربر"}))),{$axios:p}=M(),y=d(!1),C=d(""),S=d("ti-alert-triangle"),f=(l,t="ti-lock")=>{C.value=l,S.value=t,y.value=!0,setTimeout(()=>y.value=!1,3e3)},u=d([]),w=d(!0),k=d(!0),i=d(null),g=d(!1),_=N(()=>"فعال‌سازی محصول");function j(){g.value?(g.value=!1,i.value=null):T()}function T(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||window.history.length<=2?v.push("/dashboard"):v.back()}function I(l){if(i.value=l,c.value.length===1){const t=encodeURIComponent(JSON.stringify(l));v.push(`/dashboard/activate/methods?device=${t}&profile=${c.value[0].id}`)}else g.value=!0}function A(l){profileSelected.value=l,g.value=!1;const t=encodeURIComponent(JSON.stringify(i.value));v.push(`/dashboard/activate/methods?device=${t}&profile=${l.id}`)}async function B(){k.value=!0;try{const l=await p.get("user/admin/cardProducts");l?.data?.success&&Array.isArray(l.data.data)&&(b.value=l.data.data.map(t=>({name:t.name||"بدون نام",image:t.image||"/devices/default.png"})))}catch{f("خطا در دریافت محصولات","ti-alert-triangle")}finally{k.value=!1}}async function V(l){try{const t=await p.post(`v1/cards/${l}/deactivateDevice`);t?.data?.success?(f("محصول غیرفعال شد","ti-check"),u.value=u.value.filter(o=>Number(o.card_id)!==Number(l))):f(t.data?.message||"خطا","ti-alert-triangle")}catch{f("خطا در غیرفعال‌سازی","ti-alert-triangle")}}async function L(){w.value=!0;try{const l=await p.get("v1/cards/activateDevices");u.value=(l.data?.data||[]).map(t=>({card_id:t.card_id,license:t.license,name:t.device?.name||"محصول",image:t.device?.image||"/devices/default.png",activatedAt:new Date(t.updated_at).toLocaleDateString("fa-IR")}))}catch{}finally{w.value=!1}}return z(async()=>{await Promise.all([L(),B()])}),(l,t)=>(n(),r(m,null,[e("div",W,[e("div",X,[e("div",Y,[e("button",{onClick:j,class:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-accent transition-colors"},[...t[3]||(t[3]=[e("i",{class:"ti ti-arrow-right text-xl text-foreground"},null,-1)])]),t[4]||(t[4]=s()),e("h1",Z,a(_.value),1),t[5]||(t[5]=s()),t[6]||(t[6]=e("div",{class:"w-10"},null,-1))])]),t[44]||(t[44]=s()),e("div",tt,[t[22]||(t[22]=e("p",{class:"text-sm text-muted-foreground text-center mb-4 lg:mb-6"},`\r
        محصولی که می‌خواهید فعال کنید را انتخاب نمایید\r
      `,-1)),t[23]||(t[23]=s()),k.value?(n(),r("div",et,[(n(),r(m,null,x(8,o=>e("div",{key:o,class:"bg-card rounded-xl p-3 lg:p-3 animate-pulse"},[...t[7]||(t[7]=[e("div",{class:"w-16 h-16 lg:w-14 lg:h-14 bg-muted rounded-lg mx-auto mb-2 -mt-3"},null,-1),s(),e("div",{class:"h-3 bg-muted rounded w-16 lg:w-16 mx-auto"},null,-1)])])),64))])):(n(),r("div",st,[(n(!0),r(m,null,x(b.value,o=>(n(),r("button",{key:o.name,onClick:$=>I(o),class:"bg-card border border-border rounded-xl p-3 lg:p-3 text-center hover:border-primary/50 hover:shadow-md transition-all active:scale-95"},[e("img",{src:o.image,alt:o.name,class:"w-16 h-16 lg:w-14 lg:h-14 object-contain mx-auto mb-1 lg:mb-2 -mt-3"},null,8,lt),t[8]||(t[8]=s()),e("span",nt,a(o.name),1)],8,ot))),128))])),t[24]||(t[24]=s()),w.value?(n(),r("div",rt,[t[10]||(t[10]=e("div",{class:"h-5 bg-muted rounded w-32 animate-pulse"},null,-1)),t[11]||(t[11]=s()),(n(),r(m,null,x(2,o=>e("div",{key:o,class:"bg-card rounded-xl p-3 lg:p-4 animate-pulse"},[...t[9]||(t[9]=[F('<div class="flex items-center gap-3" data-v-0e35d3c9><div class="w-10 h-10 lg:w-12 lg:h-12 bg-muted rounded-lg" data-v-0e35d3c9></div> <div class="flex-1 space-y-2" data-v-0e35d3c9><div class="h-4 bg-muted rounded w-3/4" data-v-0e35d3c9></div> <div class="h-3 bg-muted rounded w-1/2" data-v-0e35d3c9></div></div></div>',1)])])),64))])):u.value.length?(n(),r("div",dt,[e("div",at,[t[12]||(t[12]=e("i",{class:"ti ti-device-mobile-check text-primary"},null,-1)),t[13]||(t[13]=s()),t[14]||(t[14]=e("h3",{class:"font-semibold text-foreground text-sm lg:text-base"},"محصولات فعال",-1)),t[15]||(t[15]=s()),e("span",it,a(u.value.length),1)]),t[20]||(t[20]=s()),e("div",ut,[(n(!0),r(m,null,x(u.value,o=>(n(),r("div",{key:o.license,class:"bg-card border border-border rounded-xl p-3 lg:p-4 flex items-center gap-2 lg:gap-3"},[e("img",{src:o.image,alt:o.name,class:"w-10 h-10 lg:w-12 lg:h-12 object-contain"},null,8,gt),t[18]||(t[18]=s()),e("div",mt,[e("h4",vt,a(o.name),1),t[16]||(t[16]=s()),e("p",ct,a(o.license),1),t[17]||(t[17]=s()),e("p",xt,a(o.activatedAt),1)]),t[19]||(t[19]=s()),e("button",{onClick:$=>V(o.card_id),class:"text-[10px] lg:text-xs text-destructive bg-destructive/10 px-2 lg:px-3 py-1 lg:py-1.5 rounded-lg hover:bg-destructive/20 transition-colors"},`\r
                غیرفعال\r
              `,8,ft)]))),128))])])):(n(),r("div",bt,[...t[21]||(t[21]=[e("i",{class:"ti ti-device-mobile-off text-3xl lg:text-4xl text-muted-foreground mb-2 lg:mb-3"},null,-1),s(),e("p",{class:"text-foreground font-medium mb-1 text-sm lg:text-base"},"محصول فعالی ندارید",-1),s(),e("p",{class:"text-[10px] lg:text-xs text-muted-foreground"},"ابتدا یک محصول را انتخاب و فعال کنید",-1)])]))]),t[45]||(t[45]=s()),(n(),E(Q,{to:"body"},[h(U,{name:"sheet"},{default:J(()=>[g.value?(n(),r("div",pt,[e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t[0]||(t[0]=(...o)=>l.cancelProfileSelection&&l.cancelProfileSelection(...o))}),t[43]||(t[43]=s()),e("div",yt,[t[38]||(t[38]=e("div",{class:"lg:hidden flex justify-center py-3"},[e("div",{class:"w-10 h-1 bg-muted-foreground/30 rounded-full"})],-1)),t[39]||(t[39]=s()),e("div",wt,[e("div",kt,[t[26]||(t[26]=e("h3",{class:"text-lg font-bold text-foreground"},"انتخاب پروفایل",-1)),t[27]||(t[27]=s()),e("button",{onClick:t[1]||(t[1]=(...o)=>l.cancelProfileSelection&&l.cancelProfileSelection(...o)),class:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-muted"},[...t[25]||(t[25]=[e("i",{class:"ti ti-x text-lg text-muted-foreground"},null,-1)])])]),t[28]||(t[28]=s()),t[29]||(t[29]=e("p",{class:"text-xs text-muted-foreground mt-1"},"کدام پروفایل به این محصول متصل شود؟",-1))]),t[40]||(t[40]=s()),e("div",ht,[e("div",Ct,[e("img",{src:i.value?.image,alt:i.value?.name,class:"w-12 h-12 object-contain"},null,8,St),t[32]||(t[32]=s()),e("div",null,[e("h4",$t,a(i.value?.name),1),t[30]||(t[30]=s()),t[31]||(t[31]=e("p",{class:"text-xs text-muted-foreground"},"محصول انتخاب شده",-1))])])]),t[41]||(t[41]=s()),e("div",Nt,[!c.value||c.value.length===0?(n(),r("div",Dt,[...t[33]||(t[33]=[e("i",{class:"ti ti-user-off text-3xl text-muted-foreground mb-2"},null,-1),s(),e("p",{class:"text-muted-foreground text-sm"},"پروفایلی یافت نشد",-1)])])):(n(),r("div",Pt,[(n(!0),r(m,null,x(c.value,o=>(n(),r("button",{key:o.id,onClick:$=>A(o),class:"w-full bg-card border border-border rounded-xl p-3 flex items-center gap-3 hover:border-primary/50 hover:bg-accent/50 transition-all active:scale-[0.98]"},[e("img",{src:o.avatar,alt:o.name,class:"w-10 h-10 rounded-full object-cover border-2 border-border"},null,8,jt),t[35]||(t[35]=s()),e("div",Tt,[e("h4",It,a(o.name),1),t[34]||(t[34]=s()),e("p",At,a(o.role),1)]),t[36]||(t[36]=s()),t[37]||(t[37]=e("i",{class:"ti ti-chevron-left text-muted-foreground"},null,-1))],8,_t))),128))]))]),t[42]||(t[42]=s()),e("div",Bt,[e("button",{onClick:t[2]||(t[2]=o=>{g.value=!1,i.value=null}),class:"w-full py-3 rounded-xl border border-border text-foreground font-medium hover:bg-muted transition-colors"},`\r
                انصراف\r
              `)])])])):O("",!0)]),_:1})]))]),t[46]||(t[46]=s()),h(G,{visible:y.value,message:C.value,icon:S.value},null,8,["visible","message","icon"])],64))}},Lt=K(Vt,[["__scopeId","data-v-0e35d3c9"]]),Rt={class:"w-full min-h-screen"},Mt={class:"p-4"},Ot=q({__name:"index",setup(D){return(v,b)=>(n(),r("div",Rt,[e("div",Mt,[h(Lt)])]))}});export{Ot as default};
