const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DVSgOK_X.js","./CE1G-McA.js","./mapbox-gl.waQx7c2W.css"])))=>i.map(i=>d[i]);
import{j as O}from"#entry";import{y as ie,r as u,d as ue,w as $,K as de,j as ce,n as D,k as i,x as a,Q as H,l as p,p as l,H as pe,q as o,L as B,s as fe,u as P,F as me,T as ge,I as ve,N as be,V as ye,a0 as he,R as xe,M as we,X as ke}from"./Ct89Yiyn.js";const Ce={key:0,class:"h-full w-full relative"},Me={key:0,class:"absolute pointer-events-none z-10",style:{left:"calc(50% - 15px)",top:"calc(50% - 38px)"}},Te={width:"30",height:"38",viewBox:"0 0 40 50",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ze=["fill"],je={key:1,class:"absolute pointer-events-none z-10",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},Le={key:2,class:"absolute inset-0 bg-muted/80 flex items-center justify-center"},Se={key:0,class:"text-xs text-primary/80 text-center px-4"},Be={key:0,class:"fixed inset-0 z-[9999] bg-background"},Pe={class:"absolute top-[72px] left-4 right-4 z-30"},Ee={class:"relative"},Re={key:0,class:"absolute top-full left-0 right-0 mt-2 bg-background border border-border rounded-xl shadow-lg z-[9999] max-h-60 overflow-y-auto"},Fe=["onClick"],_e={class:"text-sm font-medium leading-relaxed"},Ve={width:"40",height:"50",viewBox:"0 0 40 50",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ze=["fill"],Ae={key:0,xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"text-primary"},Ne={key:1,class:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"},Ie={key:1,class:"absolute bottom-6 left-4 right-4 z-20 bg-background/95 backdrop-blur-sm rounded-xl p-4 shadow-lg border border-border"},Oe={class:"text-sm text-foreground text-right leading-relaxed"},$e={key:2,class:"absolute inset-0 bg-muted/80 flex items-center justify-center z-40"},E="pk.eyJ1IjoiYmFiYXdlYiIsImEiOiJjazhwM201OXEweXU1M2VyeHozMHM3M3BrIn0.DuvjLzA_Knm6g4cjKzSVMQ",K="https://api.maptiler.com/maps/019a608b-fabf-7fcb-bcec-ff6e8a08b5ab/style.json?key=HTMa05qfktg8OBQdL2hA",Ke=ie({__name:"MapboxComponent",props:{latitude:{default:35.6992},longitude:{default:51.389},zoom:{default:14},iconColor:{default:"#000000"},interactive:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},showMarker:{type:Boolean,default:!1},showCircle:{type:Boolean,default:!1}},emits:["locationChange","confirm"],setup(X,{expose:J,emit:Q}){const r=X,R=Q,k=u(),C=u(),h=u(!0),M=u(!0),T=u(!1),x=u(!1),w=u(!1),g=u(""),z=u(""),f=u({latitude:r.latitude,longitude:r.longitude}),y=u(""),m=u([]);let j=null,n=null,b=null,d=null;const U=ue(()=>({left:"calc(50% - 20px)",top:"calc(50% - 50px + 30px)",transition:"none"})),F=async()=>{if(typeof window>"u")return null;const t=await O(()=>import("./DVSgOK_X.js").then(e=>e.m),__vite__mapDeps([0,1]),import.meta.url);return await O(()=>Promise.resolve({}),__vite__mapDeps([2]),import.meta.url),t.default},_=t=>{try{(!t.getRTLTextPluginStatus||t.getRTLTextPluginStatus()==="unavailable")&&t.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.3.0/mapbox-gl-rtl-text.js",null,!0)}catch(e){console.warn("RTL plugin already loaded or error:",e)}},V=()=>{x.value=!0,document.body.style.overflow="hidden",D(()=>{ee()})},L=()=>{x.value=!1,document.body.style.overflow="",n&&(n.remove(),n=null),T.value=!1,h.value=!0},Y=()=>{z.value=g.value,R("confirm",{latitude:f.value.latitude,longitude:f.value.longitude,address:g.value}),L()},q=async()=>{if(!navigator.geolocation){alert("مرورگر شما از موقعیت‌یابی پشتیبانی نمی‌کند");return}w.value=!0;try{const t=await new Promise((v,c)=>{navigator.geolocation.getCurrentPosition(v,c,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),{latitude:e,longitude:s}=t.coords;n&&n.flyTo({center:[s,e],zoom:16,duration:1500})}catch(t){console.error("Error getting location:",t);let e="خطا در دریافت موقعیت";t.code===1?e="دسترسی به موقعیت رد شد. لطفاً دسترسی را فعال کنید.":t.code===2?e="موقعیت در دسترس نیست":t.code===3&&(e="زمان درخواست تمام شد"),alert(e)}finally{w.value=!1}},Z=async(t,e)=>{try{const c=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${e},${t}.json?access_token=${E}&language=fa&types=address,poi,place,locality,neighborhood&country=IR&bbox=44.0,25.0,63.5,40.0`)).json();c.features&&c.features.length>0?g.value=c.features[0].place_name_fa||c.features[0].place_name||"":g.value=""}catch(s){console.error("Error getting address:",s),g.value=""}},G=()=>{j&&clearTimeout(j),j=setTimeout(async()=>{if(y.value.trim().length<3){m.value=[];return}try{const e=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(y.value)}&countrycodes=ir&viewbox=44.0,40.0,63.5,25.0&bounded=1&limit=5&accept-language=fa`)).json();m.value=e}catch{m.value=[]}},300)},W=()=>{m.value.length>0&&A(m.value[0])},A=t=>{const e=parseFloat(t.lat),s=parseFloat(t.lon);f.value={latitude:e,longitude:s},n&&n.flyTo({center:[s,e],zoom:15,duration:1500}),y.value="",m.value=[]},ee=async()=>{if(k.value)try{if(d=await F(),!d)return;_(d),d.accessToken=E,n=new d.Map({container:k.value,style:K,center:[f.value.longitude,f.value.latitude],zoom:r.zoom,attributionControl:!1,logoPosition:"bottom-right",interactive:r.interactive,dragPan:r.draggable,scrollZoom:r.interactive,doubleClickZoom:r.interactive,touchZoomRotate:r.interactive,maxBounds:[[43.5,23.5],[64,40.5]],minZoom:5,maxZoom:18,localIdeographFontFamily:"'Shabnam', 'Tahoma', sans-serif"}),r.interactive&&n.addControl(new d.NavigationControl({showCompass:!1}),"top-left"),n.on("load",()=>{h.value=!1,T.value=!0,Z(f.value.latitude,f.value.longitude)}),n.on("moveend",()=>{const t=n.getCenter();f.value={latitude:t.lat,longitude:t.lng},R("locationChange",{latitude:t.lat,longitude:t.lng}),Z(t.lat,t.lng)})}catch(t){console.error("Error initializing Mapbox:",t),h.value=!1}},te=async()=>{if(C.value)try{if(d=await F(),!d)return;_(d),d.accessToken=E,b=new d.Map({container:C.value,style:K,center:[r.longitude,r.latitude],zoom:r.zoom,attributionControl:!1,interactive:!1,dragPan:!1,scrollZoom:!1,doubleClickZoom:!1,touchZoomRotate:!1,maxBounds:[[43.5,23.5],[64,40.5]],localIdeographFontFamily:"'Shabnam', 'Tahoma', sans-serif"}),b.on("load",()=>{M.value=!1,r.showCircle&&oe(b,r.longitude,r.latitude,r.iconColor)})}catch(t){console.error("Error initializing static Mapbox:",t),M.value=!1}},N=(t,e)=>{n&&n.flyTo({center:[e,t],zoom:n.getZoom(),duration:1e3})},oe=(t,e,s,v)=>{t.getSource("circle-source")&&(t.removeLayer("circle-fill"),t.removeLayer("circle-border"),t.removeSource("circle-source"));const c=le(e,s,.15);t.addSource("circle-source",{type:"geojson",data:c}),t.addLayer({id:"circle-fill",type:"fill",source:"circle-source",paint:{"fill-color":v,"fill-opacity":.15}}),t.addLayer({id:"circle-border",type:"line",source:"circle-source",paint:{"line-color":v,"line-width":2,"line-opacity":.5}})},le=(t,e,s)=>{const c=[];for(let S=0;S<=64;S++){const I=S/64*2*Math.PI,re=s*Math.cos(I),ne=s*Math.sin(I),ae=re/(111.32*Math.cos(e*Math.PI/180)),se=ne/110.574;c.push([t+ae,e+se])}return{type:"Feature",geometry:{type:"Polygon",coordinates:[c]},properties:{}}};return $(()=>[r.latitude,r.longitude],([t,e])=>{t&&e&&(f.value={latitude:t,longitude:e},n&&N(t,e))},{immediate:!1}),$(()=>r.zoom,t=>{n&&t&&n.setZoom(t)}),de(()=>{n&&(n.remove(),n=null),b&&(b.remove(),b=null),document.body.style.overflow=""}),ce(()=>{r.showMarker&&!r.interactive&&D(()=>{te()})}),J({flyToLocation:N,openFullscreenMap:V,closeFullscreenMap:L}),(t,e)=>(a(),i(H,null,[r.showMarker&&!r.interactive?(a(),i("div",Ce,[o("div",{ref_key:"staticMapContainer",ref:C,class:"h-full w-full"},null,512),e[4]||(e[4]=l()),r.showCircle?p("",!0):(a(),i("div",Me,[(a(),i("svg",Te,[o("path",{d:"M20 0C8.954 0 0 8.954 0 20C0 35 20 50 20 50S40 35 40 20C40 8.954 31.046 0 20 0Z",fill:t.iconColor},null,8,ze),e[1]||(e[1]=l()),e[2]||(e[2]=o("circle",{cx:"20",cy:"20",r:"8",fill:"white"},null,-1))]))])),e[5]||(e[5]=l()),r.showCircle?(a(),i("div",je,[o("div",{class:"rounded-full",style:B({width:"10px",height:"10px",backgroundColor:t.iconColor,boxShadow:`0 0 0 3px ${t.iconColor}30, 0 0 0 6px ${t.iconColor}15`})},null,4)])):p("",!0),e[6]||(e[6]=l()),M.value?(a(),i("div",Le,[...e[3]||(e[3]=[o("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"},null,-1)])])):p("",!0)])):x.value?p("",!0):(a(),i("div",{key:1,onClick:V,class:"h-full w-full relative bg-muted/30 border-2 border-dashed border-muted-foreground/30 rounded-xl cursor-pointer hover:border-primary/50 hover:bg-muted/50 transition-all duration-300 flex flex-col items-center justify-center gap-3 min-h-[150px]"},[e[7]||(e[7]=fe('<div class="w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path> <circle cx="12" cy="10" r="3"></circle></svg></div> <span class="text-sm font-medium text-muted-foreground">انتخاب موقعیت روی نقشه</span> ',4)),z.value?(a(),i("span",Se,P(z.value),1)):p("",!0)])),e[25]||(e[25]=l()),(a(),pe(ke,{to:"body"},[me(ge,{name:"map-fade"},{default:ve(()=>[x.value?(a(),i("div",Be,[o("div",{class:"absolute top-0 left-0 right-0 z-30 bg-background/95 backdrop-blur-sm border-b border-border px-4 py-3 flex items-center justify-between"},[o("button",{onClick:L,class:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-muted transition-colors"},[...e[8]||(e[8]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("path",{d:"m15 18-6-6 6-6"})],-1)])]),e[9]||(e[9]=l()),e[10]||(e[10]=o("h2",{class:"text-base font-semibold"},"انتخاب موقعیت",-1)),e[11]||(e[11]=l()),o("button",{onClick:Y,class:"px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors"},`\r
            تأیید\r
          `)]),e[19]||(e[19]=l()),o("div",Pe,[o("div",Ee,[be(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),type:"text",placeholder:"جستجوی آدرس یا نام مکان...",class:"w-full px-4 py-3 bg-background/95 backdrop-blur-sm rounded-xl border border-border text-sm text-foreground shadow-lg pr-10",onInput:G,onKeydown:he(W,["enter"])},null,544),[[ye,y.value]]),e[12]||(e[12]=l()),e[13]||(e[13]=o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"absolute right-3 top-3.5 text-muted-foreground"},[o("circle",{cx:"11",cy:"11",r:"8"}),l(),o("path",{d:"m21 21-4.3-4.3"})],-1)),e[14]||(e[14]=l()),m.value.length>0?(a(),i("div",Re,[(a(!0),i(H,null,xe(m.value,s=>(a(),i("button",{key:s.place_id,onClick:v=>A(s),class:"w-full px-4 py-3 text-right hover:bg-muted border-b border-border last:border-b-0 text-foreground transition-colors"},[o("div",_e,P(s.display_name),1)],8,Fe))),128))])):p("",!0)])]),e[20]||(e[20]=l()),o("div",{ref_key:"mapContainer",ref:k,class:"h-full w-full pt-[60px]"},null,512),e[21]||(e[21]=l()),T.value?(a(),i("div",{key:0,class:"absolute pointer-events-none z-10",style:B(U.value)},[o("div",{class:"relative",style:B({color:t.iconColor})},[(a(),i("svg",Ve,[o("path",{d:"M20 0C8.954 0 0 8.954 0 20C0 35 20 50 20 50S40 35 40 20C40 8.954 31.046 0 20 0Z",fill:t.iconColor},null,8,Ze),e[15]||(e[15]=l()),e[16]||(e[16]=o("circle",{cx:"20",cy:"20",r:"8",fill:"white"},null,-1))]))],4)],4)):p("",!0),e[22]||(e[22]=l()),o("button",{onClick:q,class:we(["absolute bottom-24 left-4 z-20 w-12 h-12 bg-background shadow-lg rounded-full flex items-center justify-center hover:bg-muted transition-colors border border-border",{"animate-pulse":w.value}])},[w.value?(a(),i("div",Ne)):(a(),i("svg",Ae,[...e[17]||(e[17]=[o("circle",{cx:"12",cy:"12",r:"3"},null,-1),l(),o("path",{d:"M12 2v2"},null,-1),l(),o("path",{d:"M12 20v2"},null,-1),l(),o("path",{d:"M2 12h2"},null,-1),l(),o("path",{d:"M20 12h2"},null,-1),l(),o("path",{d:"M12 12L4.93 4.93"},null,-1),l(),o("path",{d:"M12 12l7.07-7.07"},null,-1),l(),o("path",{d:"M12 12l7.07 7.07"},null,-1),l(),o("path",{d:"M12 12L4.93 19.07"},null,-1)])]))],2),e[23]||(e[23]=l()),g.value?(a(),i("div",Ie,[o("p",Oe,P(g.value),1)])):p("",!0),e[24]||(e[24]=l()),h.value?(a(),i("div",$e,[...e[18]||(e[18]=[o("div",{class:"text-center"},[o("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),l(),o("p",{class:"text-sm text-muted-foreground"},"در حال بارگذاری نقشه...")],-1)])])):p("",!0)])):p("",!0)]),_:1})]))],64))}});export{Ke as _};
