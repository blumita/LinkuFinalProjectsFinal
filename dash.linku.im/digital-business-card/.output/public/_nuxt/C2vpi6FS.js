import{j as N,r as l,a as x,c as p,A as D,n as o}from"#entry";const I=(e,n)=>e==="subscription"&&n==="renewal_reminder"?[{label:"تمدید اشتراک",type:"primary",action:()=>o("/dashboard/upgrade")},{label:"بعداً یادآوری کن",type:"secondary",action:()=>{}}]:e==="subscription"&&n==="subscription_expired"?[{label:"تمدید فوری",type:"primary",action:()=>o("/dashboard/upgrade")}]:e==="subscription"&&n==="welcome"?[{label:"ایجاد پروفایل",type:"primary",action:()=>o("/dashboard/add-card")}]:e==="payment"&&n==="payment_warning"||n==="purchase_success"?[{label:"تمدید فوری",type:"primary",action:()=>o("/dashboard/upgrade")}]:e==="security"&&n==="new_login"?[{label:"این من بودم",type:"secondary",action:()=>{}},{label:"امنیت حساب",type:"primary",action:()=>o("/dashboard/settings")}]:e==="general"&&n==="login"?[{label:"مشاهده جزئیات",type:"secondary",action:()=>o("/dashboard/settings")}]:[],C=N("notifications",()=>{const e=l([]),n=l("all"),c=l(!1),s=l(null),d=l(0),{$axios:g}=x(),u=g,f=async(i=!1)=>{i||(c.value=!0);try{const{data:t}=await u.get("user/notifications",{params:{per_page:100,page:1}});if(!t||!t.notifications||!Array.isArray(t.notifications)){e.value=[];return}const r=t.notifications.map(a=>({id:a.id,type:a.type||"general",rawType:a.raw_type||"unknown",title:a.title||"اطلاعیه",description:a.message||"",createdAt:a.created_at?new Date(a.created_at):new Date,read:!!a.read_at,is_pinned:a.is_pinned||!1,imageUrl:a.image_url,iconUrl:a.icon_url,backgroundColor:a.background_color,actionLink:a.action_link,actions:I(a.type||"general",a.raw_type||"unknown")})),A=r.length>e.value.length||r.some(a=>!e.value.find(k=>k.id===a.id));e.value=r,d.value=Date.now(),A&&d.value>0&&y()}catch(t){console.error("Error fetching notifications:",t),e.value=[]}finally{i||(c.value=!1)}},y=()=>{try{const i=new Audio("/notification-sound.mp3");i.volume=.3,i.play().catch(()=>{})}catch{}},v=(i=15e3)=>{s.value||(s.value=D(()=>{f(!0)},i))},m=()=>{s.value&&(clearInterval(s.value),s.value=null)},_=p(()=>(n.value==="all"?e.value:e.value.filter(t=>t.type===n.value)).sort((t,r)=>t.is_pinned&&!r.is_pinned?-1:!t.is_pinned&&r.is_pinned?1:new Date(r.createdAt).getTime()-new Date(t.createdAt).getTime())),h=async i=>{const t=e.value.find(r=>r.id===i);if(t&&!t.read){t.read=!0;try{await u.post(`user/notifications/${i}/read`)}catch{t.read=!1}}},b=async()=>{e.value.forEach(i=>i.read=!0),await u.post("user/notifications/readAll")},w=p(()=>e.value.filter(i=>!i.read).length);return{notifications:e,filteredNotifications:_,activeFilter:n,loading:c,unreadCount:w,fetchNotifications:f,markAsRead:h,markAllAsRead:b,startPolling:v,stopPolling:m}});export{C as u};
